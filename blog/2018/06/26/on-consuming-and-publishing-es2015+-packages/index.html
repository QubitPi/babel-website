<!doctype html><html lang=en dir=ltr class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated=false><meta charset=UTF-8><meta name=generator content="Docusaurus v3.7.0"><title data-rh=true>On Consuming (and Publishing) ES2015+ Packages · Babel</title><meta data-rh=true name=viewport content="width=device-width, initial-scale=1.0"><meta data-rh=true name=twitter:card content=summary_large_image><meta data-rh=true property=og:url content=https://babel.qubitpi.org/blog/2018/06/26/on-consuming-and-publishing-es2015+-packages><meta data-rh=true property=og:locale content=en><meta data-rh=true name=docusaurus_locale content=en><meta data-rh=true name=docusaurus_tag content=default><meta data-rh=true name=docsearch:language content=en><meta data-rh=true name=docsearch:docusaurus_tag content=default><meta data-rh=true property=og:title content="On Consuming (and Publishing) ES2015+ Packages · Babel"><meta data-rh=true name=description content="For those of us that need to support older browsers, we run a compiler like Babel over application code. But that's not all of the code that we ship to browsers; there's also the code in our node_modules."><meta data-rh=true property=og:description content="For those of us that need to support older browsers, we run a compiler like Babel over application code. But that's not all of the code that we ship to browsers; there's also the code in our node_modules."><meta data-rh=true property=og:type content=article><meta data-rh=true property=article:published_time content=2018-06-26T12:00:00.000Z><meta data-rh=true property=article:author content=https://twitter.com/left_pad><link data-rh=true rel=icon href=/img/favicon.png><link data-rh=true rel=canonical href=https://babel.qubitpi.org/blog/2018/06/26/on-consuming-and-publishing-es2015+-packages><link data-rh=true rel=alternate href=https://babel.qubitpi.org/blog/2018/06/26/on-consuming-and-publishing-es2015+-packages hreflang=en><link data-rh=true rel=alternate href=https://babel.qubitpi.org/blog/2018/06/26/on-consuming-and-publishing-es2015+-packages hreflang=x-default><link data-rh=true rel=preconnect href=https://M7KGJDK6WF-dsn.algolia.net crossorigin=anonymous><script data-rh=true type=application/ld+json>{"@context":"https://schema.org","@id":"https://babel.qubitpi.org/blog/2018/06/26/on-consuming-and-publishing-es2015+-packages","@type":"BlogPosting","author":{"@type":"Person","name":"Henry Zhu","url":"https://twitter.com/left_pad"},"datePublished":"2018-06-26T12:00:00.000Z","description":"For those of us that need to support older browsers, we run a compiler like Babel over application code. But that's not all of the code that we ship to browsers; there's also the code in our node_modules.","headline":"On Consuming (and Publishing) ES2015+ Packages","isPartOf":{"@id":"https://babel.qubitpi.org/blog","@type":"Blog","name":"Blog"},"keywords":[],"mainEntityOfPage":"https://babel.qubitpi.org/blog/2018/06/26/on-consuming-and-publishing-es2015+-packages","name":"On Consuming (and Publishing) ES2015+ Packages","url":"https://babel.qubitpi.org/blog/2018/06/26/on-consuming-and-publishing-es2015+-packages"}</script><link rel=alternate type=application/rss+xml href=/blog/rss.xml title="Babel RSS Feed"><link rel=alternate type=application/atom+xml href=/blog/atom.xml title="Babel Atom Feed"><link rel=search type=application/opensearchdescription+xml title=Babel href=/opensearch.xml><script src=https://unpkg.com/@babel/standalone@^7.0.0/babel.min.js defer></script><script src=/js/components/mini-repl.js type=module></script><script src=/js/components/assumption-repl.js type=module></script><link rel=stylesheet href=/assets/css/styles.4495d3c0.css><script src=/assets/js/runtime~main.7be06d7f.js defer></script><script src=/assets/js/main.9f29f0a2.js defer></script><body class=navigation-with-keyboard><script>!function(){var t,e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t=null!==e?e:window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":(window.matchMedia("(prefers-color-scheme: light)").matches,"light"),document.documentElement.setAttribute("data-theme",t)}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><link rel=preload as=image href=/img/babel.svg><link rel=preload as=image href=https://d33wubrfki0l68.cloudfront.net/7a197cfe44548cc1a3f581152af70a3051e11671/78df8/img/babel.svg><script async src=https://platform.twitter.com/widgets.js charset=utf-8></script><div role=region aria-label="Skip to main content"><a class=skipToContent_oPtH href=#__docusaurus_skipToContent_fallback>Skip to main content</a></div><nav aria-label=Main class="navbar navbar--fixed-top"><div class=navbar__inner><div class=navbar__items><button aria-label="Toggle navigation bar" aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/><div class=navbar__logo><img src=/img/babel.svg alt="Babel logo" class="themedComponent_siVc themedComponent--light_hHel"><img src=/img/babel.svg alt="Babel logo" class="themedComponent_siVc themedComponent--dark_yETr"></div></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href=/docs/>Docs</a><a class="navbar__item navbar__link" href=/setup>Setup</a><a class="navbar__item navbar__link" href=/repl>Try it out</a><a class="navbar__item navbar__link" href=/videos/>Videos</a><a aria-current=page class="navbar__item navbar__link navbar__link--active" href=/blog>Blog</a><div class=navbarSearchContainer_bzqh><button type=button class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class=DocSearch-Button-Container><svg width=20 height=20 class=DocSearch-Search-Icon viewBox="0 0 20 20" aria-hidden=true><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke=currentColor fill=none fill-rule=evenodd stroke-linecap=round stroke-linejoin=round /></svg><span class=DocSearch-Button-Placeholder>Search</span></span><span class=DocSearch-Button-Keys></span></button></div><a href=https://opencollective.com/babel target=_blank rel="noopener noreferrer" class="navbar__item navbar__link">Donate<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPrP><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><a class="navbar__item navbar__link" href=/team>Team</a><a href=https://github.com/babel/babel target=_blank rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPrP><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><div class="toggle_ki11 colorModeToggle_Hewu"><button class="clean-btn toggleButton_MMFG toggleButtonDisabled_Uw7m" type=button disabled title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live=polite aria-pressed=false><svg viewBox="0 0 24 24" width=24 height=24 class=lightToggleIcon_lgto><path fill=currentColor d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 class=darkToggleIcon_U96C><path fill=currentColor d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"/></svg></button></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="main-wrapper mainWrapper_MB5r"><div class="container margin-vert--lg"><div class=row><aside class="col col--3"><nav class="sidebar_CLW8 thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_DQfJ margin-bottom--md">All Blog Posts</div><div role=group><h3 class=yearGroupHeading_jjLT>2025</h3><ul class="sidebarItemList_rvuc clean-list"><li class=sidebarItem__RMN><a class=sidebarItemLink_Ony9 href=/blog/2025/05/30/babel-8-beta>Announcing Babel 8 Beta</a><li class=sidebarItem__RMN><a class=sidebarItemLink_Ony9 href=/blog/2025/03/24/7.27.0>7.27.0 Released: better ecosystem alignment</a></ul></div><div role=group><h3 class=yearGroupHeading_jjLT>2024</h3><ul class="sidebarItemList_rvuc clean-list"><li class=sidebarItem__RMN><a class=sidebarItemLink_Ony9 href=/blog/2024/10/25/7.26.0>7.26.0 Released: stage 4 features enabled by default, and a new experimental code printer</a><li class=sidebarItem__RMN><a class=sidebarItemLink_Ony9 href=/blog/2024/07/26/7.25.0>7.25.0 Released: Safari bugfixes and duplicated named capturing groups</a><li class=sidebarItem__RMN><a class=sidebarItemLink_Ony9 href=/blog/2024/02/28/7.24.0>7.24.0 Released: Decorator updates and JSON modules imports</a></ul></div><div role=group><h3 class=yearGroupHeading_jjLT>2023</h3><ul class="sidebarItemList_rvuc clean-list"><li class=sidebarItem__RMN><a class=sidebarItemLink_Ony9 href=/blog/2023/10/16/cve-2023-45133>CVE-2023-45133: Finding an Arbitrary Code Execution Vulnerability In Babel</a><li class=sidebarItem__RMN><a class=sidebarItemLink_Ony9 href=/blog/2023/09/25/7.23.0>7.23.0 Released: Decorator Metadata and many new `import` features!</a><li class=sidebarItem__RMN><a class=sidebarItemLink_Ony9 href=/blog/2023/05/26/7.22.0>7.22.0 Released: Explicit Resource Management support and Import Attributes parsing</a><li class=sidebarItem__RMN><a class=sidebarItemLink_Ony9 href=/blog/2023/02/20/7.21.0>7.21.0 Released: Inline RegExp modifiers, TypeScript 5.0, and Decorators updates</a></ul></div><div role=group><h3 class=yearGroupHeading_jjLT>2022</h3><ul class="sidebarItemList_rvuc clean-list"><li class=sidebarItem__RMN><a class=sidebarItemLink_Ony9 href=/blog/2022/10/27/7.20.0>7.20.0 Released: Deno target and TypeScript 4.9</a><li class=sidebarItem__RMN><a class=sidebarItemLink_Ony9 href=/blog/2022/09/05/7.19.0>7.19.0 Released: Stage 3 decorators and more RegExp features!</a><li class=sidebarItem__RMN><a class=sidebarItemLink_Ony9 href=/blog/2022/05/19/7.18.0>7.18.0 Released: Destructuring private elements and TypeScript 4.7</a><li class=sidebarItem__RMN><a class=sidebarItemLink_Ony9 href=/blog/2022/02/02/7.17.0>7.17.0 Released: RegExp 'v' mode and ... 🥁 decorators!</a></ul></div><div role=group><h3 class=yearGroupHeading_jjLT>2021</h3><ul class="sidebarItemList_rvuc clean-list"><li class=sidebarItem__RMN><a class=sidebarItemLink_Ony9 href=/blog/2021/10/29/7.16.0>7.16.0 Released: ESLint 8 and TypeScript 4.5</a><li class=sidebarItem__RMN><a class=sidebarItemLink_Ony9 href=/blog/2021/07/26/7.15.0>7.15.0 Released: Hack-style pipelines, TypeScript const enums and Rhino target support</a><li class=sidebarItem__RMN><a class=sidebarItemLink_Ony9 href=/blog/2021/05/10/funding-update>Babel is used by millions, so why are we running out of money?</a><li class=sidebarItem__RMN><a class=sidebarItemLink_Ony9 href=/blog/2021/04/29/7.14.0>7.14.0 Released: New class features enabled by default, TypeScript 4.3, and better CommonJS interop</a><li class=sidebarItem__RMN><a class=sidebarItemLink_Ony9 href=/blog/2021/02/22/7.13.0>7.13.0 Released: Records and Tuples, granular compiler assumptions, and top-level targets</a></ul></div><div role=group><h3 class=yearGroupHeading_jjLT>2020</h3><ul class="sidebarItemList_rvuc clean-list"><li class=sidebarItem__RMN><a class=sidebarItemLink_Ony9 href=/blog/2020/10/15/7.12.0>7.12.0 Released: TypeScript 4.1, strings as import/export names, and class static blocks</a><li class=sidebarItem__RMN><a class=sidebarItemLink_Ony9 href=/blog/2020/07/30/7.11.0>7.11.0 Released: ECMAScript 2021 support in preset-env, TypeScript 4.0 support, printing config and the future of `babel-eslint`</a><li class=sidebarItem__RMN><a class=sidebarItemLink_Ony9 href=/blog/2020/07/13/the-state-of-babel-eslint>The State of babel-eslint</a><li class=sidebarItem__RMN><a class=sidebarItemLink_Ony9 href=/blog/2020/05/25/7.10.0>7.10.0 Released: Class Fields in preset-env, '#private in' checks and better React tree-shaking</a><li class=sidebarItem__RMN><a class=sidebarItemLink_Ony9 href=/blog/2020/03/16/7.9.0>7.9.0 Released: Smaller preset-env output, Typescript 3.8 support and a new JSX transform</a><li class=sidebarItem__RMN><a class=sidebarItemLink_Ony9 href=/blog/2020/01/11/7.8.0>7.8.0 Released: ECMAScript 2020, .mjs configuration files and @babel/cli improvements</a></ul></div><div role=group><h3 class=yearGroupHeading_jjLT>2019</h3><ul class="sidebarItemList_rvuc clean-list"><li class=sidebarItem__RMN><a class=sidebarItemLink_Ony9 href=/blog/2019/11/08/babels-funding-plans>Babel's Funding Plans</a><li class=sidebarItem__RMN><a class=sidebarItemLink_Ony9 href=/blog/2019/11/05/7.7.0>7.7.0 Released: Error recovery and TypeScript 3.7</a><li class=sidebarItem__RMN><a class=sidebarItemLink_Ony9 href=/blog/2019/09/05/7.6.0>7.6.0 Released: Private static accessors and V8 intrinsic syntax</a><li class=sidebarItem__RMN><a class=sidebarItemLink_Ony9 href=/blog/2019/07/03/7.5.0>7.5.0 Released: dynamic import and F# pipelines</a><li class=sidebarItem__RMN><a class=sidebarItemLink_Ony9 href=/blog/2019/07/02/the-babel-podcast>The Babel Podcast</a><li class=sidebarItem__RMN><a class=sidebarItemLink_Ony9 href=/blog/2019/03/19/7.4.0>7.4.0 Released: core-js 3, static private methods and partial application</a><li class=sidebarItem__RMN><a class=sidebarItemLink_Ony9 href=/blog/2019/01/21/7.3.0>7.3.0 Released: Named capturing groups, private instance accessors and smart pipelines</a></ul></div><div role=group><h3 class=yearGroupHeading_jjLT>2018</h3><ul class="sidebarItemList_rvuc clean-list"><li class=sidebarItem__RMN><a class=sidebarItemLink_Ony9 href=/blog/2018/12/03/7.2.0>7.2.0 Released: Private Instance Methods</a><li class=sidebarItem__RMN><a class=sidebarItemLink_Ony9 href=/blog/2018/09/17/7.1.0>7.1.0 Released: Decorators, Private Static Fields</a><li class=sidebarItem__RMN><a class=sidebarItemLink_Ony9 href=/blog/2018/09/17/decorators>TC39 Standards Track Decorators in Babel</a><li class=sidebarItem__RMN><a class=sidebarItemLink_Ony9 href=/blog/2018/08/27/7.0.0>Babel 7 Released</a><li class=sidebarItem__RMN><a class=sidebarItemLink_Ony9 href=/blog/2018/07/27/removing-babels-stage-presets>Removing Babel's Stage Presets</a><li class=sidebarItem__RMN><a class=sidebarItemLink_Ony9 href=/blog/2018/07/19/whats-happening-with-the-pipeline-proposal>What's Happening With the Pipeline (|>) Proposal?</a><li class=sidebarItem__RMN><a class=sidebarItemLink_Ony9 href=/blog/2018/07/16/announcing-babels-new-partnership-with-trivago>Announcing Babel's New Partnership with trivago!</a><li class=sidebarItem__RMN><a aria-current=page class="sidebarItemLink_Ony9 sidebarItemLinkActive_MJ75" href=/blog/2018/06/26/on-consuming-and-publishing-es2015+-packages>On Consuming (and Publishing) ES2015+ Packages</a></ul></div><div role=group><h3 class=yearGroupHeading_jjLT>2017</h3><ul class="sidebarItemList_rvuc clean-list"><li class=sidebarItem__RMN><a class=sidebarItemLink_Ony9 href=/blog/2017/12/27/nearing-the-7.0-release>Nearing the 7.0 Release</a><li class=sidebarItem__RMN><a class=sidebarItemLink_Ony9 href=/blog/2017/10/05/babel-turns-three>Babel Turns Three</a><li class=sidebarItem__RMN><a class=sidebarItemLink_Ony9 href=/blog/2017/09/12/planning-for-7.0>Planning for 7.0</a><li class=sidebarItem__RMN><a class=sidebarItemLink_Ony9 href=/blog/2017/09/11/zero-config-with-babel-macros>Zero-config code transformation with babel-plugin-macros</a><li class=sidebarItem__RMN><a class=sidebarItemLink_Ony9 href=/blog/contributing-to-babel-three-lessons-to-remember>Contributing to Babel: Three Lessons to Remember</a><li class=sidebarItem__RMN><a class=sidebarItemLink_Ony9 href=/blog/personal-experiences-at-babel-1-a-pr-with-unusually-high-number-of-reviews>Personal Experiences at Babel #1 — A PR with Unusually High Number of Reviews</a><li class=sidebarItem__RMN><a class=sidebarItemLink_Ony9 href=/blog/2017/08/09/babel-and-summer-of-code>Babel and Summer of Code 2017</a><li class=sidebarItem__RMN><a class=sidebarItemLink_Ony9 href=/blog/2017/03/01/upgrade-to-babel-7-for-tool-authors>Upgrade to Babel 7 for Tool Authors (WIP)</a><li class=sidebarItem__RMN><a class=sidebarItemLink_Ony9 href=/blog/2017/03/01/upgrade-to-babel-7>Upgrade to Babel 7 (moved)</a><li class=sidebarItem__RMN><a class=sidebarItemLink_Ony9 href=/blog/2017/02/13/6.23.0>6.23.0 Released</a></ul></div><div role=group><h3 class=yearGroupHeading_jjLT>2016</h3><ul class="sidebarItemList_rvuc clean-list"><li class=sidebarItem__RMN><a class=sidebarItemLink_Ony9 href=/blog/2016/12/07/the-state-of-babel>The State of Babel</a><li class=sidebarItem__RMN><a class=sidebarItemLink_Ony9 href=/blog/2016/11/16/6.19.0>6.19.0 Released</a><li class=sidebarItem__RMN><a class=sidebarItemLink_Ony9 href=/blog/2016/10/24/6.18.0>6.18.0 Released</a><li class=sidebarItem__RMN><a class=sidebarItemLink_Ony9 href=/blog/2016/09/28/6.16.0>6.16.0 Released</a><li class=sidebarItem__RMN><a class=sidebarItemLink_Ony9 href=/blog/2016/08/26/babili>Babili (babel-minify)</a><li class=sidebarItem__RMN><a class=sidebarItemLink_Ony9 href=/blog/2016/08/24/6.14.0>6.14.0 Released</a></ul></div><div role=group><h3 class=yearGroupHeading_jjLT>2015</h3><ul class="sidebarItemList_rvuc clean-list"><li class=sidebarItem__RMN><a class=sidebarItemLink_Ony9 href=/blog/2015/11/03/babel-doctor>Babel Doctor</a><li class=sidebarItem__RMN><a class=sidebarItemLink_Ony9 href=/blog/2015/10/31/setting-up-babel-6>Setting up Babel 6</a><li class=sidebarItem__RMN><a class=sidebarItemLink_Ony9 href=/blog/2015/10/29/6.0.0>6.0.0 Released</a><li class=sidebarItem__RMN><a class=sidebarItemLink_Ony9 href=/blog/2015/07/07/react-on-es6-plus>React on ES6+</a><li class=sidebarItem__RMN><a class=sidebarItemLink_Ony9 href=/blog/2015/05/14/function-bind>Function Bind Syntax</a><li class=sidebarItem__RMN><a class=sidebarItemLink_Ony9 href=/blog/2015/03/31/5.0.0>5.0.0 Released</a><li class=sidebarItem__RMN><a class=sidebarItemLink_Ony9 href=/blog/2015/02/23/babel-loves-react>Babel &lt;3 React</a><li class=sidebarItem__RMN><a class=sidebarItemLink_Ony9 href=/blog/2015/02/15/not-born-to-die>Not Born to Die</a><li class=sidebarItem__RMN><a class=sidebarItemLink_Ony9 href=/blog/2015/01/27/2to3>2to3</a><li class=sidebarItem__RMN><a class=sidebarItemLink_Ony9 href=/blog/2015/01/12/6to5-esnext>6to5 + esnext</a></ul></div></nav></aside><main class="col col--7"><article class=""><header><h1 class=title_Kdtz>On Consuming (and Publishing) ES2015+ Packages</h1><div class="container_iZB2 margin-vert--md"><time datetime=2018-06-26T12:00:00.000Z>June 26, 2018</time> · <!-- -->13 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_v1VX"><div class="avatar margin-bottom--sm"><div class="avatar__intro authorDetails_W4s3"><div class=avatar__name><a href=https://twitter.com/left_pad target=_blank rel="noopener noreferrer"><span class=authorName_Tejg>Henry Zhu</span></a></div><div class=authorSocials_VbIH></div></div></div></div></div></header><div id=__blog-post-container class=markdown><p>For those of us that need to support older browsers, we run a compiler like Babel over application code. But that's not all of the code that we ship to browsers; there's also the code in our <code>node_modules</code>.</p>
<p>Can we make compiling our dependencies not just possible, but normal?</p>
<p>The ability to compile dependencies is an enabling feature request for the whole ecosystem. Starting with some of the changes we made in Babel v7 to make selective dependency compilation possible, we hope to see it standardized moving forward.</p>
<h2 class="anchor anchorWithStickyNavbar_JmGV" id=assumptions>Assumptions<a href=#assumptions class=hash-link aria-label="Direct link to Assumptions" title="Direct link to Assumptions">​</a></h2>
<ul>
<li>We ship to modern browsers that support ES2015+ <a href=https://kangax.github.io/compat-table/es6/ target=_blank rel="noopener noreferrer">natively</a> (don't have to support IE) or are able to send multiple kinds of bundles (i.e. <a href=https://philipwalton.com/articles/deploying-es2015-code-in-production-today/ target=_blank rel="noopener noreferrer">by using <code>&lt;script type="module"></code> and <code>&lt;script nomodule></code></a> or ).</li>
<li>Our dependencies actually publish ES2015+ instead of the current baseline of ES5/ES3.</li>
<li>The future baseline shouldn't be fixed at ES2015, but is a changing target.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_JmGV" id=why>Why<a href=#why class=hash-link aria-label="Direct link to Why" title="Direct link to Why">​</a></h2>
<p>Why is compiling dependencies (as opposed to just compiling our own code) desirable in the first place?</p>
<ul>
<li>To have the freedom to make the tradeoffs of where code is able to run (vs. the library).</li>
<li>To ship less code to users, since JavaScript has a <a href=https://medium.com/dev-channel/the-cost-of-javascript-84009f51e99e target=_blank rel="noopener noreferrer">cost</a>.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_JmGV" id=the-ephemeral-javascript-runtime>The Ephemeral JavaScript Runtime<a href=#the-ephemeral-javascript-runtime class=hash-link aria-label="Direct link to The Ephemeral JavaScript Runtime" title="Direct link to The Ephemeral JavaScript Runtime">​</a></h2>
<p>The argument for why compiling dependencies would be helpful is the same for why Babel <a href=https://github.com/babel/babel/pull/3476 target=_blank rel="noopener noreferrer">eventually</a> introduced <a href=https://babeljs.io/docs/en/next/babel-preset-env.html target=_blank rel="noopener noreferrer"><code>@babel/preset-env</code></a>. We saw that developers would eventually want to move past only compiling to ES5.</p>
<p>Babel used to be <a href=https://babeljs.io/blog/2017/10/05/babel-turns-three target=_blank rel="noopener noreferrer"><code>6to5</code></a>, since it only converted from ES2015 (known as ES6 back then) to ES5. Back then, the browser support for ES2015 was almost non-existent, so the idea of a JavaScript compiler was both novel and useful: we could write modern code, and have it work for all of our users.</p>
<p>But what about the browser runtimes themselves? Because evergreen browsers will eventually catch up to the standard (as they have with ES2015), creating <code>preset-env</code> helps Babel and the community align with both the browsers and TC39 itself. If we only compiled to ES5, no one would ever run native code in the browsers.</p>
<p>The real difference is realizing that there will <em>always</em> be a sliding window of support:</p>
<ul>
<li>Application code (our supported environments)</li>
<li>Browsers (Chrome, Firefox, Edge, Safari)</li>
<li>Babel (the abstraction layer)</li>
<li>TC39/ECMAScript proposals (and Babel implementations)</li>
</ul>
<p>Thus, the need isn't just for <code>6to5</code> to be renamed to Babel because it compiles to <code>7to5</code>, but for Babel to change the implicit assumption it only targets ES5. With <code>@babel/preset-env</code>, we are able to write the latest JavaScript and target whichever browser/environment!</p>
<p>Using Babel and <code>preset-env</code> helps us keep up with that constantly changing sliding window. However, even if we use it, it's currently used only for <em>our application code</em>, and not for our code’s dependencies.</p>
<h2 class="anchor anchorWithStickyNavbar_JmGV" id=who-owns-our-dependencies>Who Owns Our Dependencies?<a href=#who-owns-our-dependencies class=hash-link aria-label="Direct link to Who Owns Our Dependencies?" title="Direct link to Who Owns Our Dependencies?">​</a></h2>
<p>Because we have control over our own code, we are able to take advantage of <code>preset-env</code>: both by writing in ES2015+ and targeting ES2015+ browsers.</p>
<p>This isn't necessarily the case for our dependencies; in order to get the same benefits as compiling our code we may need to make some changes.</p>
<p>Is it as straightforward as just running Babel over <code>node_modules</code>?</p>
<h2 class="anchor anchorWithStickyNavbar_JmGV" id=current-complexities-in-compiling-dependencies>Current Complexities in Compiling Dependencies<a href=#current-complexities-in-compiling-dependencies class=hash-link aria-label="Direct link to Current Complexities in Compiling Dependencies" title="Direct link to Current Complexities in Compiling Dependencies">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_JmGV" id=compiler-complexity>Compiler Complexity<a href=#compiler-complexity class=hash-link aria-label="Direct link to Compiler Complexity" title="Direct link to Compiler Complexity">​</a></h3>
<p>Although it shouldn't deter us from making this possible, we should be aware that compiling dependencies does increase the surface area of issues and complexity, especially for Babel itself.</p>
<ul>
<li>Compilers are no different than other programs and have bugs.</li>
<li>Not every dependency needs to be compiled, and compiling more files does mean a slower build.</li>
<li><code>preset-env</code> itself could have bugs because we use <a href=https://kangax.github.io/compat-table/es6/ target=_blank rel="noopener noreferrer"><code>compat-table</code></a> for our data vs. <a href=https://github.com/tc39/test262 target=_blank rel="noopener noreferrer">Test262</a> (the official test suite).</li>
<li>Browsers themselves can have issues with running native ES2015+ code vs. ES5.</li>
<li>There is still a question of determining what is "supported": see <a href=https://github.com/babel/babel-preset-env/issues/54 target=_blank rel="noopener noreferrer">babel/babel-preset-env#54</a> for an example of an edge case. Does it pass the test just because it parses or has partial support?</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_JmGV" id=specific-issues-in-babel-v6>Specific Issues in Babel v6<a href=#specific-issues-in-babel-v6 class=hash-link aria-label="Direct link to Specific Issues in Babel v6" title="Direct link to Specific Issues in Babel v6">​</a></h4>
<p>Running a <code>script</code> as a <code>module</code> either causes a <code>SyntaxError</code>, new runtime errors, or unexpected behavior due to the <a href=https://developers.google.com/web/fundamentals/primers/modules#intro target=_blank rel="noopener noreferrer">differences in semantics</a> between classic scripts and modules.</p>
<p>Babel v6 viewed every file as a <code>module</code> and thus in <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Strict_mode target=_blank rel="noopener noreferrer">"strict mode"</a>.</p>
<blockquote>
<p>One could argue this is actually a good thing, since everyone using Babel is opting in to strict mode by default 🙂.</p>
</blockquote>
<p>Running Babel with a conventional setup on all our <code>node_modules</code> may cause issues with code that is a <code>script</code> such as a jQuery plugin.</p>
<p>An example of an issue is how <a href=https://github.com/babel/babel/issues/7636 target=_blank rel="noopener noreferrer"><code>this</code> gets converted to <code>undefined</code></a>.</p>
<div class="language-js codeBlockContainer_mQmQ theme-code-block" style=--prism-color:#4d4d4c;--prism-background-color:#fdfaeb><div class=codeBlockTitle_x_ju>JavaScript</div><div class=codeBlockContent_D5yF><pre tabindex=0 class="prism-code language-js codeBlock_RMoD thin-scrollbar" style=color:#4d4d4c;background-color:#fdfaeb><code class=codeBlockLines_AclH><span class=token-line style=color:#4d4d4c><span class="token comment" style=color:#8e908c>// Input</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain"></span><span class="token punctuation">(</span><span class="token keyword" style=color:#8959a8>function</span><span class="token punctuation">(</span><span class="token parameter" style=color:#f5871f>$</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">  </span><span class="token comment" style=color:#8e908c>// …</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token keyword" style=color:#8959a8>this</span><span class="token punctuation">.</span><span class="token property-access">jQuery</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br></span></code></pre><div class=buttonGroup_aaMX><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_z5j7 aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_FoOz><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_L0B6><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-js codeBlockContainer_mQmQ theme-code-block" style=--prism-color:#4d4d4c;--prism-background-color:#fdfaeb><div class=codeBlockTitle_x_ju>JavaScript</div><div class=codeBlockContent_D5yF><pre tabindex=0 class="prism-code language-js codeBlock_RMoD thin-scrollbar" style=color:#4d4d4c;background-color:#fdfaeb><code class=codeBlockLines_AclH><span class=token-line style=color:#4d4d4c><span class="token comment" style=color:#8e908c>// Output</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain"></span><span class="token string" style=color:#718c00>"use strict"</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain"></span><span class="token punctuation">(</span><span class="token keyword" style=color:#8959a8>function</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter" style=color:#f5871f>$</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">  </span><span class="token comment" style=color:#8e908c>// …</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword nil" style=color:#8959a8>undefined</span><span class="token punctuation">.</span><span class="token property-access">jQuery</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br></span></code></pre><div class=buttonGroup_aaMX><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_z5j7 aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_FoOz><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_L0B6><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>This was <a href=https://github.com/babel/babel/pull/6280 target=_blank rel="noopener noreferrer">changed in v7</a> so that it won't auto-inject the <code>"use strict"</code> directive unless the source file is a <code>module</code>.</p>
<p>It was also not in Babel's original scope to compile dependencies: we actually got issue reports that people would accidentally do it, making the build slower. There is a lot of defaults and documentation in the tooling that purposely disable compiling <code>node_modules</code>.</p>
<h3 class="anchor anchorWithStickyNavbar_JmGV" id=using-non-standard-syntax>Using Non-Standard Syntax<a href=#using-non-standard-syntax class=hash-link aria-label="Direct link to Using Non-Standard Syntax" title="Direct link to Using Non-Standard Syntax">​</a></h3>
<p>There are many issues with <em>shipping</em> uncompiled proposal syntax (this post was inspired by <a href=https://twitter.com/dan_abramov/status/1009179550134296577 target=_blank rel="noopener noreferrer">Dan's concern</a> about this).</p>
<h4 class="anchor anchorWithStickyNavbar_JmGV" id=staging-process>Staging Process<a href=#staging-process class=hash-link aria-label="Direct link to Staging Process" title="Direct link to Staging Process">​</a></h4>
<p>The <a href=https://tc39.github.io/process-document/ target=_blank rel="noopener noreferrer">TC39 staging process</a> does not always move forward: a proposal can move to any point in the process: even moving backwards from Stage 3 to Stage 2 as was the case with Numeric Separators (<code>1_000</code>),  dropped entirely (<code>Object.observe()</code>, and others we may have forgotten 😁), or just stall like function bind (<code>a::b</code>) or decorators until recently.</p>
<ul>
<li>Summary of the Stages: Stage 0 has no criteria and means the proposal is just an idea, Stage 1 is accepting that the problem is worth solving, Stage 2 is about describing a solution in spec text, Stage 3 means the specific solution is thought out, and Stage 4 means that it is ready for inclusion in the spec with tests, multiple browser implementations, and in-the-field experience.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_JmGV" id=using-proposals>Using Proposals<a href=#using-proposals class=hash-link aria-label="Direct link to Using Proposals" title="Direct link to Using Proposals">​</a></h4>
<blockquote class=twitter-tweet data-lang=en><p lang=und dir=ltr><a href=https://t.co/femUb4vgxh>pic.twitter.com/femUb4vgxh</a></p>— Rach Smith 🌈 (@rachsmithtweets) <a href="https://twitter.com/rachsmithtweets/status/892478598765887488?ref_src=twsrc%5Etfw">August 1, 2017</a></blockquote>
<p>We already recommend that people should be careful when using proposals lower than Stage 3, let alone publishing them.</p>
<p>But only telling people not to use Stage X goes against the whole purpose of Babel in the first place. A big reason why proposals gain improvements and move forward are because of the feedback the committee gets from real-world usage (whether in production or not) based on using it via Babel.</p>
<p>There is certainly a balance to be had here: we don't want to scare people away from using new syntax (that is a hard sell 😂), but we also don't want people to get the idea that "once it's in Babel, the syntax is official or immutable". Ideally people look into the purpose of a proposal and make the tradeoffs for their use case.</p>
<h4 class="anchor anchorWithStickyNavbar_JmGV" id=removing-the-stage-presets-in-v7>Removing the Stage Presets in v7<a href=#removing-the-stage-presets-in-v7 class=hash-link aria-label="Direct link to Removing the Stage Presets in v7" title="Direct link to Removing the Stage Presets in v7">​</a></h4>
<p>Even though one of the most common things people do is use the Stage 0 preset, we plan to remove the stage presets in v7. We thought at first it would be convenient, that people would make their own unofficial ones anyway, or it might help with "JavaScript fatigue". It seems to cause more of an issue: people continue to copy/paste configs without understanding what goes into a preset in the first place.</p>
<p>After all, seeing <code>"stage-0"</code> says nothing. My hope is that in making the decision to use proposal plugins explicit, people will have to learn what non-standard syntax they are opting into. More intentionally, this should lead to a better understanding of not just Babel but of JavaScript as a language and its development instead of just its usage.</p>
<h3 class="anchor anchorWithStickyNavbar_JmGV" id=publishing-non-standard-syntax>Publishing Non-standard Syntax<a href=#publishing-non-standard-syntax class=hash-link aria-label="Direct link to Publishing Non-standard Syntax" title="Direct link to Publishing Non-standard Syntax">​</a></h3>
<p>As a library author, publishing non-standard syntax is setting our users up for possible inconsistencies, refactoring, and breakage of their projects. Because a TC39 proposal (even at Stage 3) has a possibility of changing, it means we will inevitability have to change the library code. A "new" proposal doesn't mean the idea is fixed or certain but rather that we collectively want to explore the solution space.</p>
<p>At least if we ship the compiled version, it will still work, and the library maintainer can change the output so that it compiles into code that works the same as before. Shipping the uncompiled version means that anyone consuming a package needs to have a build step to use it and needs to have the same configuration of Babel as us. This is in the same bucket as using TS/JSX/Flow: we wouldn't expect consumers to configure the same compiler environment just because we used them.</p>
<h3 class="anchor anchorWithStickyNavbar_JmGV" id=conflating-javascript-modules-and-es2015>Conflating JavaScript Modules and ES2015+<a href=#conflating-javascript-modules-and-es2015 class=hash-link aria-label="Direct link to Conflating JavaScript Modules and ES2015+" title="Direct link to Conflating JavaScript Modules and ES2015+">​</a></h3>
<p>When we write <code>import foo from "foo"</code> or <code>require("foo")</code> and <code>foo</code> doesn't have an <code>index.js</code>, it resolves to the <code>main</code> field in the <code>package.json</code> of the module.</p>
<p>Some tools like Rollup/webpack also read from another field called <code>module</code> (previously <code>jsnext:main</code>). It uses this to instead resolve to the JS Module file.</p>
<ul>
<li>An example with <a href=https://github.com/reactjs/redux target=_blank rel="noopener noreferrer"><code>redux</code></a></li>
</ul>
<div class="language-js codeBlockContainer_mQmQ theme-code-block" style=--prism-color:#4d4d4c;--prism-background-color:#fdfaeb><div class=codeBlockTitle_x_ju>JavaScript</div><div class=codeBlockContent_D5yF><pre tabindex=0 class="prism-code language-js codeBlock_RMoD thin-scrollbar" style=color:#4d4d4c;background-color:#fdfaeb><code class=codeBlockLines_AclH><span class=token-line style=color:#4d4d4c><span class="token comment" style=color:#8e908c>// redux package.json</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain"></span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">  </span><span class="token spread operator">...</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">  </span><span class="token string-property property">"main"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style=color:#718c00>"lib/redux.js"</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token comment" style=color:#8e908c>// ES5 + Common JS</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">  </span><span class="token string-property property">"module"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style=color:#718c00>"es/redux.js"</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token comment" style=color:#8e908c>// ES5 + JS Modules</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class=buttonGroup_aaMX><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_z5j7 aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_FoOz><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_L0B6><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>This was introduced so that users could consume JS Modules (ESM).</p>
<p>However, the sole intention of this field is ESM, not anything else. The <a href=https://github.com/rollup/rollup/wiki/pkg.module#wait-it-just-means-import-and-export--not-other-future-javascript-features target=_blank rel="noopener noreferrer">Rollup docs</a> specify that the <code>module</code> field makes it clear that it's not intended for future JavaScript syntax.</p>
<p>Despite this warning, package authors invariably conflate the use of ES modules with the JavaScript language level they authored it in.</p>
<p>As such, we may need another way to signal the language level.</p>
<h4 class="anchor anchorWithStickyNavbar_JmGV" id=non-scalable-solutions>Non-scalable Solutions?<a href=#non-scalable-solutions class=hash-link aria-label="Direct link to Non-scalable Solutions?" title="Direct link to Non-scalable Solutions?">​</a></h4>
<p>A common suggestion is for libraries to start publishing ES2015 under another field like <code>es2015</code>, e.g. <code>"es2015": "es2015/package.mjs"</code>.</p>
<div class="language-js codeBlockContainer_mQmQ theme-code-block" style=--prism-color:#4d4d4c;--prism-background-color:#fdfaeb><div class=codeBlockTitle_x_ju>JavaScript</div><div class=codeBlockContent_D5yF><pre tabindex=0 class="prism-code language-js codeBlock_RMoD thin-scrollbar" style=color:#4d4d4c;background-color:#fdfaeb><code class=codeBlockLines_AclH><span class=token-line style=color:#4d4d4c><span class="token comment" style=color:#8e908c>// @angular/core package.json</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain"></span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">  </span><span class="token string-property property">"main"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style=color:#718c00>"./bundles/core.umd.js"</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">  </span><span class="token string-property property">"module"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style=color:#718c00>"./fesm5/core.js"</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">  </span><span class="token string-property property">"es2015"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style=color:#718c00>"./fesm2015/core.js"</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">  </span><span class="token string-property property">"esm5"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style=color:#718c00>"./esm5/core.js"</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">  </span><span class="token string-property property">"esm2015"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style=color:#718c00>"./esm2015/core.js"</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">  </span><span class="token string-property property">"fesm5"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style=color:#718c00>"./fesm5/core.js"</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">  </span><span class="token string-property property">"fesm2015"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style=color:#718c00>"./fesm2015/core.js"</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class=buttonGroup_aaMX><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_z5j7 aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_FoOz><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_L0B6><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>This works for ES2015, but it begs the question of what we should do about ES2016? Are we supposed to create a new folder for each year and a new field in <code>package.json</code>? That seems unsustainable, and will continue to produce larger <code>node_modules</code>.</p>
<blockquote>
<p>This was an issue with Babel itself: we had intended to continue to publish yearly presets (<code>preset-es2015</code>, <code>preset-es2016</code>..) until we realized that <code>preset-env</code> would remove that need.</p>
</blockquote>
<p>Publishing it based on specific environments/syntax would seem to be just as untenable as the amount of combinations only increases (<code>"ie-11-arrow-functions"</code>).</p>
<p>What about distributing just the source itself? That may have similar problems if we used non-standard syntax as mentioned earlier.</p>
<p>Having a <code>esnext</code> field may not be entirely helpful either. The "latest" version of JavaScript changes depending on the point in time we authored the code.</p>
<h3 class="anchor anchorWithStickyNavbar_JmGV" id=dependencies-may-not-publish-es2015>Dependencies May Not Publish ES2015+<a href=#dependencies-may-not-publish-es2015 class=hash-link aria-label="Direct link to Dependencies May Not Publish ES2015+" title="Direct link to Dependencies May Not Publish ES2015+">​</a></h3>
<p>This effort will only be standard if it becomes straightforward to apply as a library author. It will be hard to argue for the significance of this change if both new and popular libraries aren't able to ship the latest syntax.</p>
<p>Due to the complexity and tooling setup, it may be difficult for projects to publish ES2015+/ESM. This is probably the biggest issue to get right, and adding more documentation just isn't enough.</p>
<p>For Babel, we may need to add some feature requests to <code>@babel/cli</code> to make this easier, and maybe make the <code>babel</code> package do this by default? Or we should integrate better with tools like @developit's <a href=https://github.com/developit/microbundle target=_blank rel="noopener noreferrer">microbundle</a>.</p>
<p>And how do we deal with polyfills (this will be an upcoming post)? What would it look like for a library author (or the user) to not to have to think about polyfills?</p>
<p>With all that said, how does Babel help with all this?</p>
<h2 class="anchor anchorWithStickyNavbar_JmGV" id=how-babel-v7-helps>How Babel v7 Helps<a href=#how-babel-v7-helps class=hash-link aria-label="Direct link to How Babel v7 Helps" title="Direct link to How Babel v7 Helps">​</a></h2>
<p>As we've discussed, compiling dependencies in Babel v6 can be pretty painful. Babel v7 will address some of these pain points.</p>
<p>One issue is around configuration lookup. Babel currently runs per file, so when compiling a file, it tries to find the closest config (<a href=https://babeljs.io/docs/en/next/babelrc target=_blank rel="noopener noreferrer"><code>.babelrc</code></a>) to know what to compile against. It keeps looking up the directory tree if it doesn't find it in the current folder.</p>
<div class="codeBlockContainer_mQmQ theme-code-block" style=--prism-color:#4d4d4c;--prism-background-color:#fdfaeb><div class=codeBlockContent_D5yF><pre tabindex=0 class="prism-code language-text codeBlock_RMoD thin-scrollbar" style=color:#4d4d4c;background-color:#fdfaeb><code class=codeBlockLines_AclH><span class=token-line style=color:#4d4d4c><span class="token plain">project</span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">└── .babelrc // closest config for a.js</span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">└── a.js</span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">└── node_modules</span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">    └── package</span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">        └── .babelrc // closest config for b.js</span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">        └── b.js</span><br></span></code></pre><div class=buttonGroup_aaMX><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_z5j7 aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_FoOz><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_L0B6><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>We made a <a href=https://github.com/babel/babel/pull/7358 target=_blank rel="noopener noreferrer">few changes</a>:</p>
<ul>
<li>One is to stop lookup at the package boundary (stop when we find a <code>package.json</code>). This makes sure Babel won't try to load a config file outside the app, the most surprising being when it finds one in the home directory.</li>
<li>If we use a monorepo, we may want to have a <code>.babelrc</code> per-package that extends some other central config.</li>
<li>Babel itself is a monorepo, so instead we are using the new <code>babel.config.js</code> which allows us to resolve all files to that config (no more lookup).</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_JmGV" id=selective-compilation-with-overrides>Selective Compilation with <code>"overrides"</code><a href=#selective-compilation-with-overrides class=hash-link aria-label="Direct link to selective-compilation-with-overrides" title="Direct link to selective-compilation-with-overrides">​</a></h3>
<p>We added an <a href=https://github.com/babel/babel/pull/7091 target=_blank rel="noopener noreferrer"><code>"overrides"</code></a> option which allows us to basically create a new config for any set of file paths.</p>
<blockquote>
<p>This allows every config object to specify a <code>test</code>/<code>include</code>/<code>exclude</code> field, just like you might do for Webpack. Each item allows an item, or array of items that can be a <code>string</code>, <code>RegExp</code>, or <code>function</code>.</p>
</blockquote>
<p>This allows us to have a single config for our whole app: maybe we want to compile our server JavaScript code differently than the client code (as well as compile some package(s) in <code>node_modules</code>).</p>
<div class="language-js codeBlockContainer_mQmQ theme-code-block" style=--prism-color:#4d4d4c;--prism-background-color:#fdfaeb><div class=codeBlockTitle_x_ju>JavaScript</div><div class=codeBlockContent_D5yF><pre tabindex=0 class="prism-code language-js codeBlock_RMoD thin-scrollbar" style=color:#4d4d4c;background-color:#fdfaeb><code class=codeBlockLines_AclH><span class=token-line style=color:#4d4d4c><span class="token comment" style=color:#8e908c>// babel.config.js</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">module</span><span class="token punctuation">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">  </span><span class="token literal-property property">presets</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">    </span><span class="token punctuation">[</span><span class="token string" style=color:#718c00>'@babel/preset-env'</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">      </span><span class="token literal-property property">targets</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token literal-property property">node</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style=color:#718c00>'current'</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">  </span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">  </span><span class="token literal-property property">overrides</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">    </span><span class="token literal-property property">test</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token string" style=color:#718c00>"./client-code"</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string" style=color:#718c00>"./node_modules/package-a"</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">    </span><span class="token literal-property property">presets</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">      </span><span class="token punctuation">[</span><span class="token string" style=color:#718c00>'@babel/preset-env'</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">        </span><span class="token literal-property property">targets</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token string-property property">"chrome"</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style=color:#718c00>"60"</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">    </span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class=buttonGroup_aaMX><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_z5j7 aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_FoOz><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_L0B6><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_JmGV" id=recommendations-to-discuss>Recommendations to Discuss<a href=#recommendations-to-discuss class=hash-link aria-label="Direct link to Recommendations to Discuss" title="Direct link to Recommendations to Discuss">​</a></h2>
<p>We should shift our fixed view of publishing JavaScript to one that keeps up with the latest standard.</p>
<p>We should continue to publish ES5/CJS under <code>main</code> for backwards compatibility with current tooling but also publish a version compiled down to latest syntax (no experimental proposals) under a new key we can standardize on like <code>main-es</code>. (I don't believe <code>module</code> should be that key since it was intended only for JS Modules).</p>
<blockquote>
<p>Maybe we should decide on another key in <code>package.json</code>, maybe <code>"es"</code>? Reminds me of the poll I made for <a href=https://twitter.com/left_pad/status/758429846594850816 target=_blank rel="noopener noreferrer">babel-preset-latest</a>.</p>
</blockquote>
<p>Compiling dependencies isn't just something for one project/company to take advantage of: it requires a push by the whole community to move forward. Even though this effort will be natural, it might require some sort of standardization: we can implement a set of criteria for how libraries can opt-in to publishing ES2015+ and verify this via CI/tooling/npm itself.</p>
<p>Documentation needs to updated to mention the benefits of compiling <code>node_modules</code>, how to do so for the library authors, and how to consume it in bundlers/compilers.</p>
<p>And with Babel 7, consumers can more safely use <code>preset-env</code> and opt-in to running on <code>node_modules</code> with new config options like <code>overrides</code>.</p>
<h2 class="anchor anchorWithStickyNavbar_JmGV" id=lets-do-this>Let's Do This!<a href=#lets-do-this class=hash-link aria-label="Direct link to Let's Do This!" title="Direct link to Let's Do This!">​</a></h2>
<p>Compiling JavaScript shouldn't be just about the specific ES2015/ES5 distinction, whether it's for our app or our dependencies! Hopefully this is an encouraging call to action re-starting conversations around using ES2015+ published dependencies more first-class.</p>
<p>This post goes into some of the ways Babel should help with this effort, but we'll need everyone's help to change the ecosystem: more education, more opt-in published packages, and better tooling.</p>
<hr>
<blockquote>
<p>Thanks to the <a href=https://twitter.com/left_pad/status/1010280464840617984 target=_blank rel="noopener noreferrer">many</a> folks who offered to review this post including <a href=https://twitter.com/chrisdarroch target=_blank rel="noopener noreferrer">@chrisdarroch</a>, <a href=https://twitter.com/existentialism target=_blank rel="noopener noreferrer">@existentialism</a>, <a href=https://twitter.com/mathias target=_blank rel="noopener noreferrer">@mathias</a>, <a href=https://twitter.com/betaorbust target=_blank rel="noopener noreferrer">@betaorbust</a>, <a href=https://twitter.com/_developit target=_blank rel="noopener noreferrer">@_developit</a>, <a href=https://twitter.com/jdalton target=_blank rel="noopener noreferrer">@jdalton</a>, <a href=https://twitter.com/bonsaistudio target=_blank rel="noopener noreferrer">@bonsaistudio</a>.</p>
</blockquote>
<!-- --></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href=/blog/2018/07/16/announcing-babels-new-partnership-with-trivago><div class=pagination-nav__sublabel>Newer post</div><div class=pagination-nav__label>Announcing Babel's New Partnership with trivago!</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/blog/2017/12/27/nearing-the-7.0-release><div class=pagination-nav__sublabel>Older post</div><div class=pagination-nav__label>Nearing the 7.0 Release</div></a></nav></main><div class="col col--2"><div class="tableOfContents_XG6w thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#assumptions class="table-of-contents__link toc-highlight">Assumptions</a><li><a href=#why class="table-of-contents__link toc-highlight">Why</a><li><a href=#the-ephemeral-javascript-runtime class="table-of-contents__link toc-highlight">The Ephemeral JavaScript Runtime</a><li><a href=#who-owns-our-dependencies class="table-of-contents__link toc-highlight">Who Owns Our Dependencies?</a><li><a href=#current-complexities-in-compiling-dependencies class="table-of-contents__link toc-highlight">Current Complexities in Compiling Dependencies</a><ul><li><a href=#compiler-complexity class="table-of-contents__link toc-highlight">Compiler Complexity</a><li><a href=#using-non-standard-syntax class="table-of-contents__link toc-highlight">Using Non-Standard Syntax</a><li><a href=#publishing-non-standard-syntax class="table-of-contents__link toc-highlight">Publishing Non-standard Syntax</a><li><a href=#conflating-javascript-modules-and-es2015 class="table-of-contents__link toc-highlight">Conflating JavaScript Modules and ES2015+</a><li><a href=#dependencies-may-not-publish-es2015 class="table-of-contents__link toc-highlight">Dependencies May Not Publish ES2015+</a></ul><li><a href=#how-babel-v7-helps class="table-of-contents__link toc-highlight">How Babel v7 Helps</a><ul><li><a href=#selective-compilation-with-overrides class="table-of-contents__link toc-highlight">Selective Compilation with <code>"overrides"</code></a></ul><li><a href=#recommendations-to-discuss class="table-of-contents__link toc-highlight">Recommendations to Discuss</a><li><a href=#lets-do-this class="table-of-contents__link toc-highlight">Let's Do This!</a></ul></div></div></div></div></div><footer class=nav-footer id=footer><section class=sitemap><a class=nav-home href=/><img src=https://d33wubrfki0l68.cloudfront.net/7a197cfe44548cc1a3f581152af70a3051e11671/78df8/img/babel.svg alt=Babel width=66 height=58></a><div><h5>Docs</h5><a href=/docs/learn>Learn ES2015</a></div><div><h5>Community</h5><a href=/videos>Videos</a><a href=/users>User Showcase</a><a href=http://stackoverflow.com/questions/tagged/babeljs target=_blank rel="noopener noreferrer">Stack Overflow</a><a href=https://babeljs.slack.com/ target=_blank rel="noopener noreferrer">Slack Channel</a><a href=https://x.com/babeljs target=_blank rel="noopener noreferrer">X (Twitter)</a><a href=https://bsky.app/profile/babel.dev target=_blank rel="noopener noreferrer">Bluesky</a></div><div><h5>More</h5><a href=/blog>Blog</a><a href=https://github.com/babel target=_blank rel="noopener noreferrer">GitHub Org</a><a href=https://github.com/babel/babel target=_blank rel="noopener noreferrer">GitHub Repo</a><a href=https://github.com/babel/website target=_blank rel="noopener noreferrer">Website Repo</a><a href=https://old.babeljs.io target=_blank rel="noopener noreferrer">Old 6.x Site</a><a href=http://henryzoo.com/babel.github.io target=_blank rel="noopener noreferrer">Old 5.x Site</a></div></section></footer></div>