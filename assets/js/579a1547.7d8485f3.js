"use strict";(self.webpackChunk=self.webpackChunk||[]).push([["95426"],{45012:function(e,n,t){t.r(n),t.d(n,{assets:function(){return l},contentTitle:function(){return i},default:function(){return d},frontMatter:function(){return o},metadata:function(){return s},toc:function(){return c}});var s=t(26189),a=t(24246),r=t(80980);let o={layout:"post",title:"7.15.0 Released: Hack-style pipelines, TypeScript const enums and Rhino target support",authors:"team",date:new Date("2021-07-26T00:00:00.000Z"),categories:"announcements",share_text:"Babel 7.15.0 Released"},i=void 0,l={authorsImageUrls:[void 0]},c=[{value:"Highlights",id:"highlights",level:2},{value:"ECMAScript features enabled by default",id:"ecmascript-features-enabled-by-default",level:3},{value:"New TypeScript features (#13324, #13528)",id:"new-typescript-features-13324-13528",level:3},{value:"Hack-style pipeline operator support (#13191, #13416)",id:"hack-style-pipeline-operator-support-13191-13416",level:3},{value:"Preparing <code>@babel/eslint-parser</code> for Babel 8 (#13398)",id:"preparing-babeleslint-parser-for-babel-8-13398",level:3}];function p(e){let n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.a)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(n.p,{children:["This release enables parsing top-level await (Stage 4 at the ",(0,a.jsx)(n.a,{href:"https://github.com/tc39/agendas/blob/master/2021/05.md",children:"May"})," meeting) and transforming ergonomic brand checks for private fields (Stage 4 at the ",(0,a.jsx)(n.a,{href:"https://github.com/tc39/agendas/blob/master/2021/07.md",children:"July"})," meeting) by default. There is also now support for the ",(0,a.jsx)(n.a,{href:"https://github.com/js-choi/proposal-hack-pipes",children:"Hack-style"})," pipeline operator. We also improved our TypeScript support, implementing transform support for ",(0,a.jsx)(n.code,{children:"const"})," enums and namespace aliases, and we expanded our heuristics to add ",(0,a.jsx)(n.code,{children:".displayName"})," to React components created by ",(0,a.jsx)(n.code,{children:"React.createContext()"})," (",(0,a.jsx)(n.a,{href:"https://github.com/babel/babel/pull/13501",children:"#13501"}),")."]}),"\n",(0,a.jsxs)(n.p,{children:["We also introduced a new compiler assumption, ",(0,a.jsx)(n.a,{href:"https://babeljs.io/docs/en/assumptions#noincompletensimportdetection",children:(0,a.jsx)(n.code,{children:"noIncompleteNsImportDetection"})}),", to produce a smaller output when compiling ECMAScript modules to CommonJS without worrying about partially initialized namespace imports caused by module cycles."]}),"\n",(0,a.jsxs)(n.p,{children:["Additionally, you can now specify ",(0,a.jsx)(n.a,{href:"https://mozilla.github.io/rhino/",children:"Rhino"})," as a compilation target."]}),"\n",(0,a.jsxs)(n.p,{children:["You can read the whole changelog ",(0,a.jsx)(n.a,{href:"https://github.com/babel/babel/releases/tag/v7.15.0",children:"on GitHub"}),"."]}),"\n",(0,a.jsxs)(n.p,{children:["We're really grateful for all the support the community has shown over the last months, since our ",(0,a.jsx)(n.a,{href:"https://babeljs.io/blog/2021/05/10/funding-update",children:"funding post"})," update in May. Reach out at ",(0,a.jsx)(n.a,{href:"mailto:team@babeljs.io",children:"team@babeljs.io"})," if you'd like to discuss about sponsorships!"]}),"\n",(0,a.jsx)(n.h2,{id:"highlights",children:"Highlights"}),"\n",(0,a.jsx)(n.h3,{id:"ecmascript-features-enabled-by-default",children:"ECMAScript features enabled by default"}),"\n",(0,a.jsxs)(n.p,{children:["In the last two meetings, the ",(0,a.jsxs)(n.a,{href:"https://github.com/tc39/proposal-top-level-await",children:["top-level ",(0,a.jsx)(n.code,{children:"await"})]})," and ",(0,a.jsx)(n.a,{href:"https://github.com/tc39/proposal-private-fields-in-in",children:"ergonomic brand checks for private fields"})," proposals reached Stage 4."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",metastring:'title="JavaScript"',children:'import * as db from "database";\n\nawait db.connect(); // top-level await\n\nclass DBConnector {\n  #password;\n  static isConnector(obj) {\n    return #password in obj; // ergonomic brand checks\n  }\n}\n'})}),"\n",(0,a.jsx)(n.p,{children:"Babel now supports them by default, so you can remove the following plugins from your configuration:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.code,{children:"@babel/plugin-syntax-top-level-await"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.code,{children:"@babel/plugin-syntax-private-property-in-object"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.code,{children:"@babel/plugin-proposal-private-property-in-object"})}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["Please note that Babel can currently only parse top-level ",(0,a.jsx)(n.code,{children:"await"})," and cannot transform it."]}),"\n",(0,a.jsxs)(n.h3,{id:"new-typescript-features-13324-13528",children:["New TypeScript features (",(0,a.jsx)(n.a,{href:"https://github.com/babel/babel/pull/13324",children:"#13324"}),", ",(0,a.jsx)(n.a,{href:"https://github.com/babel/babel/pull/13528",children:"#13528"}),")"]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.a,{href:"https://devblogs.microsoft.com/typescript/announcing-typescript-4-4/",children:"TypeScript 4.4"})," doesn't include any new syntax that we had to implement, other than a minor restriction: you cannot specify the value of an abstract class field."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript=",children:"abstract class C {\n    abstract prop = 1; // now a SyntaxError!\n}\n"})}),"\n",(0,a.jsxs)(n.p,{children:["However, we did add two TypeScript features that we have been missing for a long time: ",(0,a.jsx)(n.code,{children:"const"})," enums and namespace aliases (",(0,a.jsx)(n.code,{children:"import Alias = Namespace"}),")."]}),"\n",(0,a.jsxs)(n.p,{children:["Previously we presented an error when using ",(0,a.jsx)(n.code,{children:"const"})," enums since it requires type information to compile correctly. As a workaround, the community built plugins such as ",(0,a.jsx)(n.a,{href:"https://github.com/dosentmatter/babel-plugin-const-enum#readme",children:(0,a.jsx)(n.code,{children:"babel-plugin-const-enum"})}),". Babel now ignores the ",(0,a.jsx)(n.code,{children:"const"})," modifier when compiling enums, which matches TypeScript's behavior when using the ",(0,a.jsx)(n.code,{children:"--isolatedModules"})," option."]}),"\n",(0,a.jsxs)(n.p,{children:["If you want a more optimized output similar to the default code produced by TypeScript, you can enable the ",(0,a.jsx)(n.a,{href:"https://babeljs.io/docs/en/babel-preset-typescript#optimizeconstenums",children:(0,a.jsx)(n.code,{children:"optimizeConstEnums"})})," option of ",(0,a.jsx)(n.code,{children:"@babel/plugin-tranform-typescript"})," or ",(0,a.jsx)(n.code,{children:"@babel/preset-typescript"}),"."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:'// Input\nconst enum Animals { Dog }\nconsole.log(Animals.Dog);\n\n// Output (default)\nvar Animals;\n(function (Animals) {\n  Animals[Animals["Dog"] = 0] = "Dog";\n})(Animals || (Animals = {}));\n\nconsole.log(Animals.Dog);\n\n// Output with `optimizeConstEnums`\nconsole.log(0);\n'})}),"\n",(0,a.jsxs)(n.h3,{id:"hack-style-pipeline-operator-support-13191-13416",children:["Hack-style pipeline operator support (",(0,a.jsx)(n.a,{href:"https://github.com/babel/babel/pull/13191",children:"#13191"}),", ",(0,a.jsx)(n.a,{href:"https://github.com/babel/babel/pull/13416",children:"#13416"}),")"]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.a,{href:"https://github.com/js-choi/proposal-hack-pipes/",children:'"Hack-style pipelines"'})," is a new flavor of the ",(0,a.jsx)(n.a,{href:"https://github.com/tc39/proposal-pipeline-operator",children:"pipeline operator"}),' proposal, intended to replace the "smart mix" variant.']}),"\n",(0,a.jsxs)(n.p,{children:["Hack-style pipelines require you to ",(0,a.jsx)(n.em,{children:"always"}),' use a "topic token" (such as ',(0,a.jsx)(n.code,{children:"#"}),") to reference the value of the previous pipeline step:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",metastring:'title="JavaScript"',children:'// Input\n"World"\n  |> `Hello, ${#}!`\n  |> alert(#);\n\n// output\nvar _ref, _ref2;\n\n_ref2 = (_ref = "World", `Hello, ${_ref}!`), alert(_ref2);\n'})}),"\n",(0,a.jsxs)(n.p,{children:["You can test this proposal by enabling the ",(0,a.jsx)(n.a,{href:"https://babeljs.io/docs/en/babel-plugin-proposal-pipeline-operator#usage",children:(0,a.jsx)(n.code,{children:'proposal: "hack"'})})," option in ",(0,a.jsx)(n.code,{children:"@babel/plugin-proposal-pipeline-operator"}),". You must also choose which topic token to use, between ",(0,a.jsx)(n.code,{children:'"#"'})," and ",(0,a.jsx)(n.code,{children:'"%"'}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",metastring:'title="babel.config.json"',children:'{\n  "plugins": [\n    ["@babel/plugin-proposal-pipeline-operator", {\n      "proposal": "hack",\n      "topicToken": "#"\n    }]\n  ]\n}\n'})}),"\n",(0,a.jsxs)(n.h3,{id:"preparing-babeleslint-parser-for-babel-8-13398",children:["Preparing ",(0,a.jsx)(n.code,{children:"@babel/eslint-parser"})," for Babel 8 (",(0,a.jsx)(n.a,{href:"https://github.com/babel/babel/pull/13398",children:"#13398"}),")"]}),"\n",(0,a.jsx)(n.p,{children:"We have been slowly continuing to work on Babel 8 in the past months. We are not ready for a Babel 8 beta release yet, but we are starting to expose the first experimental changes."}),"\n",(0,a.jsxs)(n.p,{children:["We plan to fully convert Babel from CommonJS to ECMAScript modules, but this has a problem: configuration loading will be asynchronous ",(0,a.jsx)(n.em,{children:"more often"}),", and ",(0,a.jsx)(n.code,{children:"@babel/eslint-parser"})," can only work synchronously (because ESLint only supports synchronous parsers)."]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"@babel/eslint-parser"})," 7.15.0 exposes a new entry-point: ",(0,a.jsx)(n.code,{children:"@babel/eslint-parser/experimental-worker"}),". It moves the Babel config loading and parsing task to a separate worker which is managed synchronously from the main thread, while still supporting async configuration loading. As an immediate advantage for Babel 7, it allows using native ECMAScript modules for Babel configuration files even when using ",(0,a.jsx)(n.code,{children:"@babel/eslint-parser"}),"."]}),"\n",(0,a.jsxs)(n.p,{children:["You can help us by testing it now in your existing projects, and reporting any bug ",(0,a.jsx)(n.a,{href:"https://github.com/babel/babel/issues/new?assignees=&labels=i%3A+needs+triage&template=bug_report.yml&title=%5BBug%5D%3A+",children:"on our issues page"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",metastring:'title="JavaScript"',children:'// .eslintrc.js\nmodule.exports = {\n  parser: "@babel/eslint-parser/experimental-worker"\n};\n'})}),"\n",(0,a.jsx)(n.admonition,{type:"info",children:(0,a.jsx)(n.p,{children:"This entry-point requires Node.js >= 12.3.0"})})]})}function d(e={}){let{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(p,{...e})}):p(e)}},80980:function(e,n,t){t.d(n,{Z:function(){return i},a:function(){return o}});var s=t(27378);let a={},r=s.createContext(a);function o(e){let n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),s.createElement(r.Provider,{value:n},e.children)}},26189:function(e){e.exports=JSON.parse('{"permalink":"/blog/2021/07/26/7.15.0","source":"@site/blog/2021-07-26-7.15.0.md","title":"7.15.0 Released: Hack-style pipelines, TypeScript const enums and Rhino target support","description":"This release enables parsing top-level await (Stage 4 at the May meeting) and transforming ergonomic brand checks for private fields (Stage 4 at the July meeting) by default. There is also now support for the Hack-style pipeline operator. We also improved our TypeScript support, implementing transform support for const enums and namespace aliases, and we expanded our heuristics to add .displayName to React components created by React.createContext() (#13501).","date":"2021-07-26T00:00:00.000Z","tags":[],"readingTime":4.42,"hasTruncateMarker":true,"authors":[{"name":"Babel Team","url":"https://twitter.com/babeljs","email":"team@babeljs.io","key":"team","page":null}],"frontMatter":{"layout":"post","title":"7.15.0 Released: Hack-style pipelines, TypeScript const enums and Rhino target support","authors":"team","date":"2021-07-26T00:00:00.000Z","categories":"announcements","share_text":"Babel 7.15.0 Released"},"unlisted":false,"prevItem":{"title":"7.16.0 Released: ESLint 8 and TypeScript 4.5","permalink":"/blog/2021/10/29/7.16.0"},"nextItem":{"title":"Babel is used by millions, so why are we running out of money?","permalink":"/blog/2021/05/10/funding-update"}}')}}]);